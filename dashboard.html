<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Dashboard
  </title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com">
  </script>
  <!-- Inter Font -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
   <!-- Font Awesome for Icons -->
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   <style>
    body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #333;
            display: block !important; /* Ensure body is block for flex alignment */
        }
        .tab-content {
            display: none; /* Hidden by default */
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        .tab-content.active {
            display: block; /* Show when active */
            opacity: 1;
            transform: translateY(0);
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
            display: flex; /* For icon and text alignment */
            align-items: center;
        }
        .tab-button:hover {
            transform: translateY(-2px);
            color: #15803d; /* Green hover color */
        }
        .tab-button.active {
            border-bottom: 3px solid #15803d; /* Green active border */
            color: #15803d; /* Green active color */
        }

        /* Floating Glassmorphism Nav Bar */
        .floating-nav {
            position: fixed;
            top: 20px; /* Adjust vertical position as needed */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000; /* Ensure it stays on top */
            background-color: rgba(255, 255, 255, 0.15); /* Translucent white */
            backdrop-filter: blur(10px); /* Glassmorphism blur effect */
            border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle border */
            border-radius: 9999px; /* Pill shape */
            padding: 0.5rem 1.5rem; /* Adjust padding for pill shape */
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); /* Soft shadow */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem; /* Space between buttons */
            transition: all 0.3s ease-in-out;
        }
        .floating-nav .tab-button {
            padding: 0.75rem 1.25rem; /* Adjust padding for buttons within the pill */
            border-bottom: none; /* Remove individual button border */
            border-radius: 9999px; /* Make individual buttons pill-shaped too */
            white-space: nowrap; /* Prevent text wrapping */
        }
        .floating-nav .tab-button.active {
            background-color: rgba(21, 128, 61, 0.1); /* Light green background for active */
            color: #15803d; /* Green active color */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        /* No purple on hover for tab buttons */
        .floating-nav .tab-button:hover {
            color: #15803d; /* Keep green hover */
            background-color: rgba(21, 128, 61, 0.05); /* Very light green background on hover */
        }

        /* Mobile bottom nav overrides */
        @media (max-width: 767px) {
            .floating-nav {
                top: auto !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                transform: none !important;
                border-radius: 0 !important;
                padding: 0 !important;
                background-color: rgba(255, 255, 255, 0.95) !important;
                border: none !important;
                box-shadow: 0 -1px 10px rgba(0,0,0,0.1) !important;
                justify-content: space-around !important;
                gap: 0 !important;
                height: 56px;
            }
            .floating-nav .tab-button {
                padding: 0 !important;
                border-radius: 0 !important;
                border-bottom: none !important;
                flex-direction: column !important;
                font-size: 0.75rem !important;
                color: #6b7280 !important;
                min-width: 0 !important;
                flex-grow: 1;
                justify-content: center;
                position: relative;
                transition: color 0.2s ease-in-out;
            }
            .floating-nav .tab-button i {
                margin: 0 !important;
                font-size: 1.25rem !important;
                line-height: 1;
            }
            .floating-nav .tab-button:not(.active) span {
                display: none !important;
            }
            .floating-nav .tab-button.active {
                color: #15803d !important;
                background-color: transparent !important;
                box-shadow: none !important;
            }
            .floating-nav .tab-button.active span {
                display: block !important;
                font-size: 0.75rem !important;
                line-height: 1;
                margin-top: 2px;
                white-space: nowrap;
            }
        }

        /* Custom styles for the card preview */
        .card-preview {
            width: 300px;
            height: 180px;
            background-color: #000; /* Default Black background */
            background-size: cover;
            background-position: center;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            color: white;
            transition: all 0.3s ease-in-out;
            transform: scale(1);
        }
        .card-preview:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.6);
        }

        .card-preview::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 70%);
            transform: rotate(45deg);
            pointer-events: none;
            opacity: 0.8;
        }
        .card-logo {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            overflow: hidden; /* Ensure image fits */
            transition: transform 0.2s ease-in-out;
        }
        .card-logo:hover {
            transform: scale(1.1);
        }
        .card-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .card-name {
            position: absolute;
            bottom: 15px;
            left: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            max-width: 60%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .card-qr {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 70px;
            height: 70px;
            background-color: white;
            padding: 5px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease-in-out;
        }
        .card-qr:hover {
            transform: rotate(5deg) scale(1.05);
        }
        .card-qr img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Input Group Styling */
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4b5563;
        }
        .input-group input[type="text"],
        .input-group input[type="email"],
        .input-group input[type="tel"],
        .input-group input[type="url"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #15803d; /* Green focus border */
            box-shadow: 0 0 0 3px rgba(21, 128, 61, 0.2); /* Green focus shadow */
        }

        /* Custom File Selector */
        .custom-file-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: #fff;
            cursor: pointer;
            font-size: 1rem;
            color: #4b5563;
            transition: border-color 0.2s, box-shadow 0.2s, background-color 0.2s;
        }
        .custom-file-label:hover {
            border-color: #15803d; /* Green hover border */
            background-color: #f9fafb;
        }
        .custom-file-label .file-name {
            flex-grow: 1;
            margin-right: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #6b7280;
        }
        .custom-file-label .select-button {
            background-color: #15803d; /* Green button */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
        }
        .custom-file-label .select-button:hover {
            background-color: #126c34; /* Darker green hover */
        }

        /* Custom Color Selector */
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .color-square {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .color-square.selected {
            border-color: #15803d; /* Green border for selected color */
            box-shadow: 0 0 0 3px rgba(21, 128, 61, 0.3);
            transform: scale(1.1);
        }
        .color-square:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }


        /* Custom Dropdown Selector */
        .custom-select {
            display: block;
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 0.75rem; /* Adjust padding for arrow */
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: #fff;
            -webkit-appearance: none; /* Remove default arrow */
            -moz-appearance: none;
            appearance: none;
            background-image: none; /* Ensure no default background arrow */
            font-size: 1rem;
            color: #333;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .custom-select:focus {
            outline: none;
            border-color: #15803d; /* Green focus border */
            box-shadow: 0 0 0 3px rgba(21, 128, 61, 0.2); /* Green focus shadow */
        }

        .btn-primary {
            background-color: #15803d; /* Green button */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Pill shape */
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative; /* For shimmer */
            overflow: hidden; /* For shimmer */
        }
        .btn-primary:hover {
            background-color: #126c34; /* Darker green hover */
            transform: translateY(-2px);
        }
        .btn-primary:active {
            background-color: #0e5228; /* Even darker green active */
            transform: translateY(0);
        }
        /* Shimmer effect for buttons */
        .btn-primary::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 30%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            transform: skewX(-20deg);
            transition: none; /* Reset transition for shimmer */
        }
        .btn-primary:hover::after {
            animation: shimmer 1s infinite;
        }
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 150%; }
        }


        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #15803d; /* Green spinner */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #e5e7eb;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0; /* Initially hidden */
            transform: scale(0.9); /* Initially smaller */
        }
        .image-preview[src]:not([src=""]) {
            opacity: 1; /* Show when src is set */
            transform: scale(1); /* Scale up when shown */
        }

        .qr-code-container canvas {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Custom Radio Buttons for Card Type */
        .custom-radio-label {
            cursor: pointer;
            display: inline-block;
        }
        .custom-radio-button {
            padding: 0.75rem 1.25rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            font-weight: 500;
            color: #4b5563;
            background-color: #fff;
        }
        .custom-radio-label input[type="radio"]:checked + .custom-radio-button {
            border-color: #15803d; /* Green border for selected */
            background-color: rgba(21, 128, 61, 0.1); /* Faded green background */
            color: #15803d; /* Green text */
            box-shadow: 0 0 0 2px rgba(21, 128, 61, 0.2); /* Subtle glow */
        }
        .custom-radio-label:hover .custom-radio-button {
            border-color: #15803d; /* Green hover border */
            background-color: #f0fdf4; /* Very light green on hover */
        }

        /* Toggle Switch for Social Media */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #15803d; /* Green when checked */
        }
        input:focus + .toggle-slider {
            box-shadow: 0 0 1px #15803d;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(16px);
        }

        /* Social Media List Item Styling */
        .social-link-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: #fff;
            border-radius: 1rem; /* More curved border */
            box-shadow: none; /* Removed box shadow */
            border: 1px solid #e5e7eb; /* Subtle border */
            transition: all 0.2s ease-in-out;
        }
        .social-link-item:hover {
            transform: translateY(-2px);
            border-color: #15803d; /* Green border on hover */
        }
        .social-link-item .icon {
            font-size: 1.5rem;
            width: 2.5rem;
            text-align: center;
            color: #15803d;
        }
        .social-link-item .content {
            flex-grow: 1;
            margin-left: 1rem;
        }
        .social-link-item .platform-name {
            font-weight: 600;
            color: #333;
        }
        .social-link-item .url-input-wrapper { /* New wrapper for input to allow flex grow */
            flex-grow: 1;
            margin-right: 1rem; /* Space between input and toggle */
        }
        .social-link-item .url-input { /* Style for the input field itself */
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .social-link-item .url-input:focus {
            outline: none;
            border-color: #15803d;
            box-shadow: 0 0 0 2px rgba(21, 128, 61, 0.2);
        }

        .social-link-item .actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-left: 1rem;
        }
        .social-link-item .delete-btn {
            background: none;
            border: none;
            color: #ef4444; /* Red for delete */
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s ease-in-out;
        }
        .social-link-item .delete-btn:hover {
            transform: scale(1.1);
        }

        /* Island Notification */
        .notification-island {
            position: fixed;
            top: 80px; /* Below floating nav */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            background-color: rgba(21, 128, 61, 0.9); /* Green background */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Pill shape */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .notification-island.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .notification-island.error {
            background-color: rgba(220, 38, 38, 0.9); /* Red for errors */
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark semi-transparent background */
            backdrop-filter: blur(5px); /* Blur effect */
            z-index: 2000; /* Above everything else */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            transform: translateY(20px);
            opacity: 1;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1rem;
        }
        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: #333;
        }
        .modal-step {
            display: none; /* Hidden by default */
        }
        .modal-step.active {
            display: block;
        }
        .modal-footer {
            margin-top: 1.5rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
        }
        .modal-footer button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Pill shape */
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #333;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .link-in-bio-display {
            background-color: #f0fdf4;
            border: 1px solid #15803d;
            border-radius: 9999px;
            padding: 0.75rem 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 1.1rem;
            font-weight: 500;
            color: #15803d;
            margin-top: 1rem;
        }
        .link-in-bio-display .copy-btn {
            background-color: #15803d;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
        }
        .link-in-bio-display .copy-btn:hover {
            background-color: #126c34;
        }
        .profile-pic-overview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #15803d;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Recent Activity Styles */
        .recent-activity-container {
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-top: 1.5rem;
        }
        .activity-item {
            display: flex;
            align-items: flex-start; /* Align items to the start for multi-line details */
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .activity-item:last-child {
            border-bottom: none;
        }
        .activity-icon {
            font-size: 1.25rem;
            color: #15803d;
            margin-right: 1rem;
            width: 24px; /* Fixed width for alignment */
            text-align: center;
            flex-shrink: 0; /* Prevent icon from shrinking */
        }
        .activity-details {
            flex-grow: 1;
        }
        .activity-message {
            font-weight: 500;
            color: #374151;
        }
        .activity-meta {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .pagination-button {
            background-color: #15803d;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .pagination-button:hover:not(:disabled) {
            background-color: #126c34;
        }
        .pagination-button:disabled {
            background-color: #a7f3d0; /* Lighter green for disabled */
            cursor: not-allowed;
        }
        .pagination-info {
            font-weight: 500;
            color: #4b5563;
        }

        /* Timeline for card order status */
        .order-timeline {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0 1rem;
        }
        .order-step {
            flex: 1;
            text-align: center;
            position: relative;
            font-weight: 600;
            color: #6b7280;
            font-size: 0.875rem;
        }
        .order-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            width: 100%;
            height: 3px;
            background-color: #d1d5db;
            transform: translateY(-50%);
            z-index: -1;
        }
        .order-step.active {
            color: #ea580c; /* Orange for processing */
        }
        .order-step.active.completed {
            color: #15803d; /* Green for completed */
        }
        .order-step.active.intransit {
            color: #2563eb; /* Blue for intransit */
        }
        .order-step .circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #d1d5db;
            margin: 0 auto 6px auto;
            position: relative;
            z-index: 1;
        }
        .order-step.active .circle {
            background-color: currentColor;
        }

        /* Image Scraper Modal Styles */
        #imageScraperModal {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #imageScraperModal.show {
            opacity: 1;
            visibility: visible;
        }
        #imageScraperModal .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 90vw;
            max-height: 90vh;
            width: 600px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        #imageScraperModal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        #imageScraperModal .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }
        #imageScraperModal .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        #imageScraperModal .modal-close-btn:hover {
            color: #333;
        }
        #imageScraperModal input[type="text"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }
        #imageScraperModal button {
            background-color: #15803d;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
            align-self: flex-start;
        }
        #imageScraperModal button:hover {
            background-color: #126c34;
        }
        #img-scraper-status {
            margin-top: 0.5rem;
            font-weight: 500;
            color: #15803d;
        }
        #img-scraper-error {
            margin-top: 0.5rem;
            font-weight: 500;
            color: #dc2626;
        }
        #img-scraper-results-container {
            margin-top: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fill,minmax(100px,1fr));
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
        }
        #img-scraper-results-container img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 0.5rem;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease-in-out;
        }
        #img-scraper-results-container img:hover,
        #img-scraper-results-container img.selected {
            border-color: #15803d;
        }
        #img-scraper-results-container p.pm-initial-message {
            grid-column: 1 / -1;
            text-align: center;
            color: #6b7280;
            font-style: italic;
        }

        /* Lookbook Modal Styles */
        #lookbookModal {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 4000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #lookbookModal.show {
            opacity: 1;
            visibility: visible;
        }
        #lookbookModal .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 90vw;
            max-height: 90vh;
            width: 700px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        #lookbookModal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        #lookbookModal .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }
        #lookbookModal .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        #lookbookModal .modal-close-btn:hover {
            color: #333;
        }
        #lookbookModal .url-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }
        #lookbookModal .btn-primary {
            align-self: flex-start;
            margin-bottom: 1rem;
        }
        #lookbookModal #lookbookImagesGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill,minmax(100px,1fr));
            gap: 0.75rem;
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        #lookbookModal #lookbookImagesGrid img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 0.5rem;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease-in-out;
        }
        #lookbookModal #lookbookImagesGrid img.selected {
            border-color: #15803d;
        }
        #lookbookModal .input-group {
            margin-bottom: 1rem;
        }
        button.btn-primary.mb-2.w-full.sm\:w-auto {
    max-height: 2.5em;
    position: absolute;
    top: 0;
    left: 0;
}
div#lookbookImagesGrid {
    position: relative;
}
.tab-content-container {
    padding: 1em
}
.bg-white.rounded-lg.shadow-xl.w-full.overflow-hidden.pt-20.md\:pt-20 {
    min-height: 100vh;
        padding-top: 7em;
}
@media (max-width: 768px) {
    .bg-white.rounded-lg.shadow-xl.w-full.overflow-hidden.pt-20.md\:pt-20 {
        padding-top: 1em;
        padding-bottom: 4em;
    }
    div#linkInBioDisplay {
    font-size: .8em;
}
    .floating-nav .tab-button.active {
        color: #15803d !important;
        background-color: transparent !important;
        box-shadow: none !important;
        display: flex
;
        flex-direction: row !important;
        gap: .5em;
    }
    .custom-file-label {
        font-size: 0.8rem;
    }
}

/* Tooltip container */
.tooltip {
  position: relative;
  display: inline-block;
  cursor: help;
  color: #4b5563;
  font-weight: 500;
  margin-left: 0.25rem;
}

/* Tooltip text */
.tooltip .tooltiptext {
  visibility: hidden;
  width: 220px;
  background-color: rgba(21, 128, 61, 0.9);
  color: #fff;
  text-align: left;
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
  position: absolute;
  z-index: 10;
  bottom: -2.75rem;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  line-height: 1.2;
  opacity: 0;
  transition: opacity 0.3s;
  box-shadow: 0 2px 6px rgba(21, 128, 61, 0.4);
}

/* Tooltip arrow */
.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: -6px;
  left: 50%;
  transform: translateX(-50%);
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent rgba(21, 128, 61, 0.9) transparent;
}

/* Show the tooltip text when hovering */
.tooltip:hover .tooltiptext,
.tooltip:focus-within .tooltiptext {
  visibility: visible;
  opacity: 1;
}
div#cardTapsChartContainer {
    position: relative;
}
canvas {
    width: 100%;
}
/* Empty stats container with scattered icons */
.empty-stats-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 256px;
  border-radius: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
  margin-top: 1rem;
}

.empty-stats-icon {
  position: absolute;
  font-size: 2rem;
  opacity: 0.3;
  transition: transform 0.3s ease;
  user-select: none;
}

.empty-stats-icon:hover {
  transform: scale(1.3);
  opacity: 0.6;
  color: #15803d;
}

/* Positions for scattered icons */
.empty-stats-icon.pos1 { top: 10%; left: 15%; color: #ef4444; }
.empty-stats-icon.pos2 { top: 20%; right: 20%; color: #f59e0b; }
.empty-stats-icon.pos3 { top: 50%; left: 40%; color: #3b82f6; }
.empty-stats-icon.pos4 { bottom: 15%; right: 25%; color: #10b981; }
.empty-stats-icon.pos5 { bottom: 10%; left: 30%; color: #8b5cf6; }
.empty-stats-icon.pos6 { top: 40%; right: 10%; color: #ec4899; }
.empty-stats-icon.pos7 { bottom: 40%; left: 10%; color: #f97316; }
.empty-stats-icon.pos8 { top: 70%; right: 30%; color: #3b82f6; }
.empty-stats-icon.pos9 { bottom: 25%; left: 50%; color: #22c55e; }
.empty-stats-icon.pos10 { top: 60%; left: 60%; color: #a855f7; }

/* Responsive adjustments for card preview */
@media (max-width: 768px) {
  .card-preview {
    width: 100%;
    height: 200px;
  }
  .card-name {
    font-size: 1rem;
    max-width: 50%;
  }
  .card-qr {
    width: 60px;
    height: 60px;
  }
}

/* Disabled input style for cardCta */
input[disabled] {
  background-color: #e5e7eb;
  cursor: not-allowed;
  color: #6b7280;
}
   </style>
  </link>
 </head>
 <body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white rounded-lg shadow-xl w-full overflow-hidden pt-20 md:pt-20">
   <!-- Changed max-w-5xl to w-full -->
   <!-- Floating Glassmorphism Nav Bar -->
   <nav aria-label="Main navigation" class="floating-nav" role="tablist">
    <button aria-controls="overview" aria-selected="true" class="tab-button py-4 px-6 block focus:outline-none active" data-tab="overview" id="tab-overview" role="tab">
     <i aria-hidden="true" class="fas fa-chart-line mr-2">
     </i>
     <span>
      Overview
     </span>
    </button>
    <button aria-controls="appearance" aria-selected="false" class="tab-button py-4 px-6 block focus:outline-none" data-tab="appearance" id="tab-appearance" role="tab">
     <i aria-hidden="true" class="fas fa-paint-brush mr-2">
     </i>
     <span>
      Appearance
     </span>
    </button>
    <button aria-controls="contact" aria-selected="false" class="tab-button py-4 px-6 block focus:outline-none" data-tab="contact" id="tab-contact" role="tab">
     <i aria-hidden="true" class="fas fa-address-book mr-2">
     </i>
     <span>
      Contact
     </span>
    </button>
    <button aria-controls="social-media" aria-selected="false" class="tab-button py-4 px-6 block focus:outline-none" data-tab="social-media" id="tab-social-media" role="tab">
     <i aria-hidden="true" class="fas fa-share-alt mr-2">
     </i>
     <span>
      Social Media
     </span>
    </button>
   </nav>
   <!-- Island Notification Container -->
   <div aria-atomic="true" aria-live="assertive" class="notification-island" id="notificationIsland" role="alert">
   </div>
   <!-- Tab Content -->
   <div class="tab-content-container">
    <!-- Overview Tab -->
    <div aria-labelledby="tab-overview" class="tab-content active" id="overview" role="tabpanel" tabindex="0">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Overview &amp; Stats
     </h2>
     <!-- Profile Details Section -->
     <div class="bg-gray-50 p-6 rounded-lg shadow-sm mb-6 flex items-center gap-4">
      <img alt="Profile Picture of the user" class="profile-pic-overview" height="80" id="overviewProfilePic" src="https://storage.googleapis.com/a1aa/image/eba9bbfc-85a3-4f2f-2182-3c8d1f8638fc.jpg" width="80"/>
      <div>
       <h3 class="text-xl font-semibold text-gray-700" id="overviewProfileName">
        Your Name
       </h3>
       <p class="text-gray-600">
        Welcome to your dashboard!
       </p>
      </div>
     </div>
     <!-- Link-in-Bio Section -->
     <div class="bg-gray-50 p-6 rounded-lg shadow-sm mb-6">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">
       Your Link-in-Bio
      </h3>
      <div class="link-in-bio-display" id="linkInBioDisplay" style="display: none;">
       <span id="actualLinkInBio">
       </span>
       <button aria-label="Copy link to clipboard" class="copy-btn" id="copyLinkBtn">
        Copy
       </button>
      </div>
      <button class="btn-primary w-full" id="setupLinkBtn" style="display: none;">
       Set up Link in Bio
      </button>
      <p class="text-sm text-gray-500 mt-2" id="linkInBioMessage">
      </p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
       <h3 class="text-xl font-semibold text-gray-700 mb-4">
        Page Visits
       </h3>
       <div class="h-64" id="pageVisitsChartContainer">
        <canvas aria-label="Page Visits Chart" id="pageVisitsChart" role="img">
        </canvas>
        <div class="empty-stats-container" id="emptyPageVisitsIcons" style="display:none;">
         <i class="fas fa-eye empty-stats-icon pos1" title="Page Views">
         </i>
         <i class="fas fa-chart-line empty-stats-icon pos2" title="Analytics">
         </i>
         <i class="fas fa-users empty-stats-icon pos3" title="Visitors">
         </i>
         <i class="fas fa-clock empty-stats-icon pos4" title="Time">
         </i>
         <i class="fas fa-globe empty-stats-icon pos5" title="Global">
         </i>
        </div>
       </div>
      </div>
      <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
       <h3 class="text-xl font-semibold text-gray-700 mb-4">
        Website Clicks
       </h3>
       <div class="h-64" id="websiteVisitsChartContainer">
        <canvas aria-label="Website Clicks Chart" id="websiteVisitsChart" role="img">
        </canvas>
        <div class="empty-stats-container" id="emptyWebsiteClicksIcons" style="display:none;">
         <i class="fas fa-mouse-pointer empty-stats-icon pos1" title="Clicks">
         </i>
         <i class="fas fa-link empty-stats-icon pos2" title="Links">
         </i>
         <i class="fas fa-globe empty-stats-icon pos3" title="Website">
         </i>
         <i class="fas fa-bolt empty-stats-icon pos4" title="Speed">
         </i>
         <i class="fas fa-hand-pointer empty-stats-icon pos5" title="Interaction">
         </i>
        </div>
       </div>
      </div>
      <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
       <h3 class="text-xl font-semibold text-gray-700 mb-4">
        Card Taps
       </h3>
       <div class="h-64" id="cardTapsChartContainer">
        <canvas aria-label="Card Taps Chart" id="cardTapsChart" role="img">
        </canvas>
        <div class="empty-stats-container" id="emptyCardTapsIcons" style="display:none;">
         <i class="fas fa-id-card empty-stats-icon pos1" title="Card">
         </i>
         <i class="fas fa-hand-pointer empty-stats-icon pos2" title="Tap">
         </i>
         <i class="fas fa-mobile-alt empty-stats-icon pos3" title="Mobile">
         </i>
         <i class="fas fa-bolt empty-stats-icon pos4" title="Speed">
         </i>
         <i class="fas fa-signal empty-stats-icon pos5" title="Signal">
         </i>
        </div>
       </div>
      </div>
     </div>
     <!-- Recent Activity Section -->
     <div class="recent-activity-container mt-6">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">
       Recent Activity
      </h3>
      <div aria-live="polite" aria-relevant="additions removals" class="space-y-2" id="recentActivityList">
      </div>
      <p class="text-gray-500 text-center py-4" id="noRecentActivity" style="display: none;">
       No recent activity.
      </p>
      <div class="pagination-controls" id="activityPagination" style="display: none;">
       <button aria-label="Previous page" class="pagination-button" disabled="" id="prevActivityPage">
        Previous
       </button>
       <span aria-atomic="true" aria-live="polite" class="pagination-info" id="activityPageInfo">
        Page 1 of 1
       </span>
       <button aria-label="Next page" class="pagination-button" disabled="" id="nextActivityPage">
        Next
       </button>
      </div>
     </div>
    </div>
    <!-- Appearance Tab -->
    <div aria-labelledby="tab-appearance" class="tab-content" id="appearance" role="tabpanel" tabindex="0">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Appearance Settings
     </h2>
     <form class="space-y-6" id="appearanceForm" novalidate="">
      <div class="input-group">
       <label for="profileNameInput">
        Name:
        <span aria-label="Your display name on your profile." class="tooltip" tabindex="0">
         <i class="fas fa-info-circle">
         </i>
         <span class="tooltiptext">
          Your display name on your profile.
         </span>
        </span>
       </label>
       <input autocomplete="name" id="profileNameInput" name="profileName" placeholder="Your Name" type="text"/>
      </div>
      <div class="input-group">
       <label for="profileIntroInput">
        Introduction:
        <span aria-label="A short introduction or tagline (max 25 characters)." class="tooltip" tabindex="0">
         <i class="fas fa-info-circle">
         </i>
         <span class="tooltiptext">
          A short introduction or tagline (max 25 characters).
         </span>
        </span>
       </label>
       <input id="profileIntroInput" maxlength="25" name="profileIntro" placeholder="A brief intro (max 25 chars)" type="text"/>
      </div>
      <div class="input-group">
       <label>
        Background Color:
       </label>
       <div aria-label="Background color options" class="color-palette" id="backgroundColorPalette" role="list">
       </div>
       <input id="selectedBackgroundColor" name="backgroundColor" type="hidden"/>
      </div>
      <div class="input-group">
       <label aria-describedby="backgroundImageFileName" class="custom-file-label" for="backgroundImage" role="button" tabindex="0">
        Bg Image:
        <span class="file-name" id="backgroundImageFileName">
         No file chosen
        </span>
        <span class="select-button">
         Choose File
        </span>
       </label>
       <input accept="image/*" aria-hidden="true" class="hidden" id="backgroundImage" name="backgroundImage" type="file"/>
       <img alt="Background Image Preview" class="image-preview" id="backgroundImagePreview" src="" style="display: none;"/>
       <p class="text-sm text-gray-500 mt-1">
        Upload an image or select a color. Image takes precedence.
       </p>
      </div>
      <div class="input-group">
       <label aria-describedby="heroImageFileName" class="custom-file-label" for="heroImage" role="button" tabindex="0">
        Hero Image:
        <span class="file-name" id="heroImageFileName">
         No file chosen
        </span>
        <span class="select-button">
         Choose File
        </span>
       </label>
       <input accept="image/*" aria-hidden="true" class="hidden" id="heroImage" name="heroImage" type="file"/>
       <img alt="Hero Image Preview" class="image-preview" id="heroImagePreview" src="" style="display: none;"/>
      </div>
      <div class="input-group">
       <label aria-describedby="profileImageFileName" class="custom-file-label" for="profileImage" role="button" tabindex="0">
        Profile Image:
        <span class="file-name" id="profileImageFileName">
         No file chosen
        </span>
        <span class="select-button">
         Choose File
        </span>
       </label>
       <input accept="image/*" aria-hidden="true" class="hidden" id="profileImage" name="profileImage" type="file"/>
       <img alt="Profile Image Preview" class="image-preview" id="profileImagePreview" src="" style="display: none;"/>
      </div>
      <button class="btn-primary" type="submit">
       Save Appearance
       <span class="loading-spinner" id="appearanceLoading" style="display: none;">
       </span>
      </button>
      <p class="text-sm mt-2" id="appearanceMessage">
      </p>
     </form>
    </div>
    <!-- Contact Tab -->
    <div aria-labelledby="tab-contact" class="tab-content" id="contact" role="tabpanel" tabindex="0">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Contact Information
     </h2>
     <form class="space-y-6" id="contactForm" novalidate="">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <!-- Responsive grid for contact fields -->
       <div class="input-group">
        <label for="contactEmail">
         Email:
        </label>
        <input autocomplete="email" id="contactEmail" name="email" placeholder="your.email@example.com" type="email"/>
       </div>
       <div class="input-group">
        <label for="contactPhone">
         Whatsapp:
        </label>
        <input autocomplete="tel" id="contactPhone" name="phone" placeholder="2346567890 (do not add '+')" type="tel"/>
       </div>
       <div class="input-group" style="display: none;">
        <label for="contactAddress">
         Address:
        </label>
        <input autocomplete="url" id="contactAddress" name="address" placeholder="123 Ahjuville" type="url"/>
       </div>
       <div class="input-group">
        <label for="contactWebsite">
         Website:
        </label>
        <input autocomplete="url" id="contactWebsite" name="website" placeholder="https://yourwebsite.com" type="url"/>
       </div>
       <div class="input-group">
        <label for="contactWebsiteMessage">
         Website Message:
        </label>
        <input id="contactWebsiteMessage" name="websiteMessage" placeholder="Visit my site!" type="text"/>
       </div>
      </div>
      <button class="btn-primary" type="submit">
       Save Contact
       <span class="loading-spinner" id="contactLoading" style="display: none;">
       </span>
      </button>
      <p class="text-sm mt-2" id="contactMessage">
      </p>
     </form>
    </div>
    <!-- Social Media Tab -->
    <div aria-labelledby="tab-social-media" class="tab-content" id="social-media" role="tabpanel" tabindex="0">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Social Media Links
     </h2>
     <div class="space-y-4" id="socialLinksList">
      <!-- Instagram -->
      <div class="social-link-item" data-platform-id="instagram">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-instagram">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         Instagram
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Instagram URL or Username" class="url-input" placeholder="Enter Instagram URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Instagram link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Instagram link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Substack -->
      <div class="social-link-item" data-platform-id="substack">
       <div class="icon">
        <i aria-hidden="true" class="fas fa-newspaper">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         Substack
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Substack URL or Username" class="url-input" placeholder="Enter Substack URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Substack link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Substack link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- TikTok -->
      <div class="social-link-item" data-platform-id="tiktok">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-tiktok">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         TikTok
        </div>
        <div class="url-input-wrapper">
         <input aria-label="TikTok URL or Username" class="url-input" placeholder="Enter TikTok URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate TikTok link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear TikTok link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Threads -->
      <div class="social-link-item" data-platform-id="threads">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-threads">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         Threads
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Threads URL or Username" class="url-input" placeholder="Enter Threads URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Threads link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Threads link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Reddit -->
      <div class="social-link-item" data-platform-id="reddit">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-reddit-alien">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         Reddit
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Reddit URL or Username" class="url-input" placeholder="Enter Reddit URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Reddit link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Reddit link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- X (Twitter) -->
      <div class="social-link-item" data-platform-id="x">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-x-twitter">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         X (Twitter)
        </div>
        <div class="url-input-wrapper">
         <input aria-label="X (Twitter) URL or Username" class="url-input" placeholder="Enter X (Twitter) URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate X (Twitter) link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear X (Twitter) link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- WhatsApp -->
      <div class="social-link-item" data-platform-id="whatsapp">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-whatsapp">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         WhatsApp
        </div>
        <div class="url-input-wrapper">
         <input aria-label="WhatsApp URL or Number" class="url-input" placeholder="Enter WhatsApp URL/Number" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate WhatsApp link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear WhatsApp link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Facebook -->
      <div class="social-link-item" data-platform-id="facebook">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-facebook-f">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         Facebook
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Facebook URL or Username" class="url-input" placeholder="Enter Facebook URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Facebook link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Facebook link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- LinkedIn -->
      <div class="social-link-item" data-platform-id="linkedin">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-linkedin-in">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         LinkedIn
        </div>
        <div class="url-input-wrapper">
         <input aria-label="LinkedIn URL or Username" class="url-input" placeholder="Enter LinkedIn URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate LinkedIn link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear LinkedIn link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Medium -->
      <div class="social-link-item" data-platform-id="medium">
       <div class="icon">
        <i aria-hidden="true" class="fab fa-medium-m">
        </i>
       </div>
       <div class="content">
        <div class="platform-name">
         Medium
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Medium URL or Username" class="url-input" placeholder="Enter Medium URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Medium link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Medium link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Upwork -->
      <div class="social-link-item" data-platform-id="upwork">
       <div class="icon">
        <img alt="Upwork logo icon green background with white U letter" class="inline-block w-6 h-6 rounded" height="24" src="https://storage.googleapis.com/a1aa/image/fea84e39-19b5-49f4-8ad4-5af45bb85e1d.jpg" width="24"/>
       </div>
       <div class="content">
        <div class="platform-name">
         Upwork
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Upwork URL or Username" class="url-input" placeholder="Enter Upwork URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Upwork link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Upwork link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
      <!-- Fiverr -->
      <div class="social-link-item" data-platform-id="fiverr">
       <div class="icon">
        <img alt="Fiverr logo icon green background with white F letter" class="inline-block w-6 h-6 rounded" height="24" src="https://storage.googleapis.com/a1aa/image/cc1c3e60-5c3f-44f2-20dd-fdf7926378f7.jpg" width="24"/>
       </div>
       <div class="content">
        <div class="platform-name">
         Fiverr
        </div>
        <div class="url-input-wrapper">
         <input aria-label="Fiverr URL or Username" class="url-input" placeholder="Enter Fiverr URL/Username" type="text"/>
        </div>
       </div>
       <div class="actions">
        <label aria-label="Activate Fiverr link" class="toggle-switch">
         <input type="checkbox"/>
         <span class="toggle-slider">
         </span>
        </label>
        <button aria-label="Clear Fiverr link" class="delete-btn" title="Clear Link">
         <i aria-hidden="true" class="fas fa-trash-alt">
         </i>
        </button>
       </div>
      </div>
     </div>
     <p class="text-gray-500 text-center py-4" id="noSocialLinks" style="display: none;">
      No social links added yet.
     </p>
     <!-- Advanced Lookbook Section -->
     <div class="mt-10 border-t pt-6">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">
       Advanced: Create Lookbook from Store Images
      </h3>
      <div class="flex flex-col sm:flex-row items-center gap-4 mb-4">
       <input aria-label="Store URL input for image extraction" class="w-full sm:w-auto flex-grow px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" id="coverImageInput" placeholder="Enter your store URL" type="url"/>
       <button class="btn-primary" id="extractFromSiteBtn" type="button">
        Import Images
       </button>
      </div>
      <p class="text-sm text-gray-500 mb-4" id="lookbookImportStatus">
      </p>
      <div aria-label="Imported images grid for lookbook selection" aria-live="polite" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="lookbookImagesGrid">
      </div>
      <button class="btn-primary" disabled="" id="completeLookbookBtn" type="button">
       Complete Lookbook
      </button>
      <div class="mt-6">
       <h3 class="text-xl font-semibold text-gray-700 mb-4">
        Your Lookbook
       </h3>
       <div class="bg-gray-50 p-4 rounded-lg shadow-sm" id="userLookbookContainer">
        <p class="text-gray-500" id="noLookbookMessage">
         You have no lookbook created yet.
        </p>
        <div class="hidden" id="lookbookDisplay">
         <h4 class="text-lg font-semibold mb-2" id="lookbookTitle">
         </h4>
         <div aria-label="User lookbook images grid" aria-live="polite" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-4" id="lookbookImagesDisplay">
         </div>
         <div class="flex gap-4">
          <button class="btn-primary" id="editLookbookBtn" type="button">
           Edit Lookbook
          </button>
          <button class="btn-secondary" id="deleteLookbookBtn" type="button">
           Delete Lookbook
          </button>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Activate Card Tab -->
    <div aria-labelledby="tab-activate-card" class="tab-content" id="activate-card" role="tabpanel" tabindex="0">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Preview NFC Card
     </h2>
     <div class="flex flex-col md:flex-row gap-8">
      <form class="space-y-6 flex-1" id="cardForm" novalidate="">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Responsive grid for card fields -->
        <div class="input-group">
         <label for="cardName">
          Card Name:
          <span aria-label="The name displayed on your NFC card." class="tooltip" tabindex="0">
           <i class="fas fa-info-circle">
           </i>
           <span class="tooltiptext">
            The name displayed on your NFC card.
           </span>
          </span>
         </label>
         <input autocomplete="off" id="cardName" name="name" placeholder="@lourdjxke" type="text"/>
        </div>
        <div class="input-group">
         <label for="cardCta">
          Call to Action (Link/Number):
          <span aria-label="This link is prefilled and cannot be changed." class="tooltip" tabindex="0">
           <i class="fas fa-info-circle">
           </i>
           <span class="tooltiptext">
            This link is prefilled and cannot be changed.
           </span>
          </span>
         </label>
         <input autocomplete="off" disabled="" id="cardCta" name="cta" placeholder="https://anju.cc/username" type="text"/>
        </div>
       </div>
       <div class="input-group">
        <label>
         Card Type:
        </label>
        <div aria-label="Select card type" class="flex flex-wrap gap-4 mt-2" role="radiogroup">
         <label aria-checked="false" aria-labelledby="cardTypePlatinum" class="custom-radio-label" role="radio" tabindex="0">
          <input class="hidden" name="cardTypeRadio" type="radio" value="platinum"/>
          <span class="custom-radio-button" id="cardTypePlatinum">
           Platinum
          </span>
         </label>
         <label aria-checked="true" aria-labelledby="cardTypeBlack" class="custom-radio-label" role="radio" tabindex="0">
          <input checked="" class="hidden" name="cardTypeRadio" type="radio" value="black"/>
          <span class="custom-radio-button" id="cardTypeBlack">
           Black
          </span>
         </label>
         <label aria-checked="false" aria-labelledby="cardTypeBamboo" class="custom-radio-label" role="radio" tabindex="0">
          <input class="hidden" name="cardTypeRadio" type="radio" value="bamboo"/>
          <span class="custom-radio-button" id="cardTypeBamboo">
           Bamboo
          </span>
         </label>
        </div>
       </div>
       <div class="input-group">
        <label for="cardLogoUpload">
         Upload Logo:
         <span aria-label="You can upload a logo to display on your card." class="tooltip" tabindex="0">
          <i class="fas fa-info-circle">
          </i>
          <span class="tooltiptext">
           You can upload a logo to display on your card.
          </span>
         </span>
        </label>
        <label aria-describedby="cardLogoFileName" class="custom-file-label" for="cardLogoUpload" role="button" tabindex="0">
         Logo File:
         <span class="file-name" id="cardLogoFileName">
          No file chosen
         </span>
         <span class="select-button">
          Choose File
         </span>
        </label>
        <input accept="image/*" aria-hidden="true" class="hidden" id="cardLogoUpload" name="cardLogoUpload" type="file"/>
        <img alt="Card Logo Preview" class="image-preview" id="cardLogoPreview" src="" style="display: none;"/>
       </div>
    </a>
       <p class="text-sm mt-2" id="cardMessage">
       </p>
      </form>
      <div class="flex-1 flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg shadow-sm">
       <h3 class="text-xl font-semibold text-gray-700 mb-4">
        Card Preview
       </h3>
       <div aria-atomic="true" aria-label="Card preview" aria-live="polite" class="card-preview" id="cardPreviewContainer">
        <div aria-label="Card logo" class="card-logo" id="previewLogo">
         <i aria-hidden="true" class="fas fa-id-card">
         </i>
         <!-- Default icon -->
        </div>
        <div class="card-name" id="previewName">
         Your Name
        </div>
        <div aria-label="QR code" class="card-qr" id="previewQr">
        </div>
       </div>
      </div>
     </div>
     <div class="mt-6" id="cardOrderStatusContainer" style="display: none;">
     </div>
    </div>
   </div>
  </div>
  <!-- Modal for Link-in-Bio Setup -->
  <div aria-describedby="modalDescription" aria-labelledby="modalTitle" aria-modal="true" class="modal-overlay" id="linkSetupModal" role="dialog">
   <div class="modal-content">
    <div class="modal-header">
     <h3 id="modalTitle">
      Set up Your Link-in-Bio
     </h3>
     <button aria-label="Close modal" class="modal-close-btn" id="closeModalBtn">
      
     </button>
    </div>
    <!-- Step 1: Username Input -->
    <div class="modal-step active" id="modalStep1">
     <p class="text-gray-700 mb-4" id="modalDescription">
      Choose a unique username for your link-in-bio.
     </p>
     <div class="input-group mb-4">
      <label for="usernameInput">
       Username:
      </label>
      <input autocomplete="username" class="w-full" id="usernameInput" placeholder="e.g., yourname123" type="text"/>
      <p class="text-sm mt-1" id="usernameAvailabilityMessage">
      </p>
     </div>
     <div class="modal-footer">
      <button class="btn-primary" id="checkUsernameBtn">
       Check Availability
      </button>
      <button class="btn-primary" disabled="" id="nextStep1Btn">
       Next
      </button>
     </div>
    </div>
    <!-- Step 2: Email Verification -->
    <div class="modal-step" id="modalStep2">
     <p class="text-gray-700 mb-4">
      Your email is not verified. Please verify your email to activate your link-in-bio.
     </p>
     <div class="modal-footer">
      <button class="btn-primary" id="sendVerificationEmailBtn">
       Send Email Verification Link
      </button>
      <button class="btn-primary" id="iHaveVerifiedBtn">
       I have verified
      </button>
     </div>
     <p class="text-sm mt-2 text-center" id="emailVerificationMessage">
     </p>
    </div>
   </div>
  </div>
  <!-- Image Scraper Modal -->
  <div aria-labelledby="imgScraperTitle" aria-modal="true" class="hidden" id="imageScraperModal" role="dialog">
   <div class="modal-content">
    <div class="modal-header">
     <h3 id="imgScraperTitle">
      Import Images from URL
     </h3>
     <button aria-label="Close image scraper modal" class="modal-close-btn" id="img-scraper-close">
      
     </button>
    </div>
    <input aria-label="Enter URL to fetch images" id="img-scraper-url" placeholder="Enter URL here" type="text"/>
    <button class="btn-primary mt-2" id="img-scraper-fetch-btn" type="button">
     Fetch Images
    </button>
    <p aria-live="polite" id="img-scraper-status">
    </p>
    <p aria-live="assertive" id="img-scraper-error">
    </p>
    <div id="img-scraper-results-container">
    </div>
   </div>
  </div>
  <!-- Lookbook Modal -->
  <div aria-labelledby="lookbookModalTitle" aria-modal="true" class="hidden" id="lookbookModal" role="dialog">
   <div class="modal-content">
    <div class="modal-header">
     <h3 id="lookbookModalTitle">
      Name Your Lookbook
     </h3>
     <button aria-label="Close lookbook modal" class="modal-close-btn" id="lookbookCloseBtn">
      
     </button>
    </div>
    <div class="input-group">
     <label for="lookbookNameInput">
      Lookbook Name:
     </label>
     <input id="lookbookNameInput" placeholder="Enter lookbook name" type="text"/>
    </div>
    <div class="modal-footer">
     <button class="btn-primary" disabled="" id="saveLookbookBtn">
      Save Lookbook
     </button>
     <button class="btn-secondary" id="cancelLookbookBtn">
      Cancel
     </button>
    </div>
   </div>
  </div>
  <!-- EmailJS SDK -->
  <script src="https://cdn.emailjs.com/dist/email.min.js">
  </script>
  <!-- Combined JavaScript (merged from all JS files) -->
  <script src="https://cdn.tailwindcss.com">
  </script>
  <script type="module">
      
   // Firebase SDK Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getDatabase, ref, set, onValue, remove, update, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- Global Firebase Variables (Provided by Canvas Environment) ---
        // Using the user-provided Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD-GCRFbpLQwU55kShhS-DtNSNOPEySQ_g",
            authDomain: "octen-29d12.firebaseapp.com",
            databaseURL: "https://octen-29d12-default-rtdb.firebaseio.com",
            projectId: "octen-29d12",
            storageBucket: "octen-29d12.appspot.com",
            messagingSenderId: "1095439842170",
            appId: "1:1095439842170:web:da0dc8a2c414c60f33f4c3",
            measurementId: "G-483MYXKNVL"
        };
        // Using project ID as a logical appId for data paths, though not directly used in the new RTDB path structure
        const appId = firebaseConfig.projectId; 

        // --- Firebase Instances ---
        let app, auth, db, storage, rtdb;
        let userId = null;
        let isAuthReady = false;
        let currentUserEmailVerified = false;
        let currentUsername = ''; // To store the username from RTDB

        // --- Recent Activity Pagination State ---
        let currentPage = 1;
        const itemsPerPage = 5; // Number of activity items per page
        let allActivityData = []; // To store all fetched activity data

        // --- Lookbook State ---
        let lookbookSelectedImages = new Set();
        let userLookbookId = null; // To store the single lookbook ID for the user
        let userLookbookData = null; // To store the lookbook data for editing

        // --- Utility Functions ---
        /**
         * Displays an island-like notification at the top of the screen.
         * @param {string} message - The message text.
         * @param {boolean} [isError=false] - Whether the message is an error (applies red background).
         * @param {boolean} [persist=false] - If true, the notification will not automatically hide.
         */
        
        function showIslandNotification(message, isError = false, persist = false) {
            const notificationIsland = document.getElementById('notificationIsland');
            notificationIsland.textContent = message;
            notificationIsland.className = 'notification-island show'; // Reset classes
            if (isError) {
                notificationIsland.classList.add('error');
            } else {
                notificationIsland.classList.remove('error'); // Ensure error class is removed for non-errors
            }

            // Clear any existing timeout to prevent conflicts if called rapidly or to stop a persistent one
            clearTimeout(notificationIsland.dataset.timeoutId);

            if (!persist) {
                const timeoutId = setTimeout(() => {
                    notificationIsland.classList.remove('show');
                    setTimeout(() => {
                        notificationIsland.textContent = '';
                    }, 300); // Match CSS transition duration
                }, 5000);
                notificationIsland.dataset.timeoutId = timeoutId; // Store timeout ID
            }
            // If persist is true, no timeout is set, so it stays visible
        }

        /**
         * Uploads a file to Firebase Storage and returns its download URL.
         * @param {File} file - The file to upload.
         * @param {string} path - The storage path (e.g., `users/${userId}/images`).
         * @returns {Promise<string|null>} - The download URL of the uploaded file, or null if no file.
         */
        async function uploadImage(file, path) {
            if (!file) return null;
            const fileRef = storageRef(storage, `${path}/${file.name}_${Date.now()}`);
            await uploadBytes(fileRef, file);
            return await getDownloadURL(fileRef);
        }

        /**
         * Sets up a custom file input listener.
         * @param {string} inputId - The ID of the hidden file input.
         * @param {string} fileNameId - The ID of the span to display the file name.
         * @param {string} previewId - The ID of the image preview element (optional).
         */
        function setupCustomFileInput(inputId, fileNameId, previewId = null) {
            const fileInput = document.getElementById(inputId);
            const fileNameSpan = document.getElementById(fileNameId);
            const previewImage = previewId ? document.getElementById(previewId) : null;

            fileInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    fileNameSpan.textContent = e.target.files[0].name;
                    if (previewImage) {
                        previewImage.src = URL.createObjectURL(e.target.files[0]);
                        previewImage.style.display = 'block';
                    }
                } else {
                    fileNameSpan.textContent = 'No file chosen';
                    if (previewImage) {
                        previewImage.src = '';
                        previewImage.style.display = 'none';
                    }
                }
            });
        }

        /**
         * Copies text to the clipboard.
         * @param {string} text - The text to copy.
         */
        function copyTextToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showIslandNotification('Link copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showIslandNotification('Failed to copy link.', true);
            }
            document.body.removeChild(textarea);
        }


        // --- Firebase Initialization ---
        /**
         * Initializes Firebase and authenticates the user.
         * Sets up an auth state listener to update userId and isAuthReady.
         * @returns {Promise<void>}
         */
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                rtdb = getDatabase(app);
                storage = getStorage(app); 
                db = getFirestore(app); 

                return new Promise((resolve) => {
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            userId = user.uid;
                            currentUserEmailVerified = user.emailVerified;
                            console.log("Authenticated user ID:", userId, "Email Verified:", currentUserEmailVerified);
                            isAuthReady = true;
                            // Hide "Not logged in" notification if it was showing
                            showIslandNotification('', false, false); // Clear and hide any persistent notification
                        } else {
                            userId = null; // Ensure userId is null if not authenticated
                            isAuthReady = false;
                            console.log("User not logged in. Redirecting to auth.html (console log only).");
                            console.log("Redirecting to auth.html"); // Explicitly log redirect
                            window.location.href = 'auth.html'; // Redirect to auth page
                            showIslandNotification('Not logged in', true, true); // Show persistent error notification
                        }
                        resolve(); // Resolve the promise once auth state is determined
                    });
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showIslandNotification(`Firebase init error: ${error.message}`, true);
                throw error; // Re-throw to indicate initialization failure
            }
        }

        // --- Tab Navigation Logic ---
        /**
         * Initializes the tab navigation functionality.
         * Sets up event listeners for tab buttons to switch content with animations.
         */
        function initTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const transitionDuration = 300; // Match CSS transition duration

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const currentActiveButton = document.querySelector('.tab-button.active');
                    const currentActiveContent = document.querySelector('.tab-content.active');
                    const targetTab = button.dataset.tab;
                    const newActiveContent = document.getElementById(targetTab);

                    // Deactivate current tab and content
                    if (currentActiveButton) {
                        currentActiveButton.classList.remove('active');
                        currentActiveButton.setAttribute('aria-selected', 'false');
                    }
                    if (currentActiveContent) {
                        currentActiveContent.classList.remove('active'); // Start fade-out/slide-out
                        currentActiveContent.setAttribute('hidden', '');
                        // After transition, set display to none
                        setTimeout(() => {
                            currentActiveContent.style.display = 'none';
                        }, transitionDuration);
                    }

                    // Activate new tab button
                    button.classList.add('active');
                    button.setAttribute('aria-selected', 'true');

                    // Activate new tab content
                    newActiveContent.style.display = 'block'; // Set display to block immediately
                    newActiveContent.removeAttribute('hidden');
                    // Force reflow to ensure display:block is applied before transition starts
                    void newActiveContent.offsetWidth;
                    newActiveContent.classList.add('active'); // Trigger fade-in/slide-in

                    // If navigating to overview, ensure its content is loaded/updated
                    if (targetTab === 'overview' && isAuthReady && userId) {
                        loadOverviewContent();
                    }
                    if (targetTab === 'activate-card' && isAuthReady && userId) {
                        loadCardOrderStatus();
                    }
                });
            });

            // The HTML already sets 'active' for overview.
            // The `loadOverviewContent` will be explicitly called after Firebase init.
        }

        // --- Appearance Tab Logic ---
        /**
         * Initializes the appearance management functionality.
         * Sets up form submission, image previews, and loads existing settings.
         */
        function initAppearanceManager() {
            const appearanceForm = document.getElementById('appearanceForm');
            const profileNameInput = document.getElementById('profileNameInput'); // New
            const profileIntroInput = document.getElementById('profileIntroInput'); // New
            const backgroundImageInput = document.getElementById('backgroundImage');
            const backgroundImagePreview = document.getElementById('backgroundImagePreview');
            const heroImageInput = document.getElementById('heroImage');
            const heroImagePreview = document.getElementById('heroImagePreview');
            const profileImageInput = document.getElementById('profileImage');
            const profileImagePreview = document.getElementById('profileImagePreview');
            const appearanceLoading = document.getElementById('appearanceLoading');
            const backgroundColorPalette = document.getElementById('backgroundColorPalette');
            const selectedBackgroundColorInput = document.getElementById('selectedBackgroundColor');

            // Define the 10 subtle background colors
            const subtleColors = [
                '#F8F8F8', '#F0F4F7', '#E8F0F3', '#E0EAEF', '#D8E4E8',
                '#FDF6E3', '#F7EDD9', '#EFE4D0', '#E7DBC7', '#DFD2BE'
            ];

            // Generate color squares
            subtleColors.forEach(color => {
                const colorSquare = document.createElement('div');
                colorSquare.className = 'color-square';
                colorSquare.style.backgroundColor = color;
                colorSquare.dataset.color = color;
                colorSquare.setAttribute('role', 'button');
                colorSquare.setAttribute('tabindex', '0');
                colorSquare.setAttribute('aria-label', `Select background color ${color}`);
                colorSquare.addEventListener('click', () => {
                    // Remove 'selected' from all squares
                    document.querySelectorAll('.color-square').forEach(sq => sq.classList.remove('selected'));
                    // Add 'selected' to clicked square
                    colorSquare.classList.add('selected');
                    selectedBackgroundColorInput.value = color; // Set hidden input value
                    backgroundImageInput.value = ''; // Clear file input if color is selected
                    backgroundImagePreview.src = '';
                    backgroundImagePreview.style.display = 'none';
                    document.getElementById('backgroundImageFileName').textContent = 'No file chosen';
                });
                colorSquare.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        colorSquare.click();
                    }
                });
                backgroundColorPalette.appendChild(colorSquare);
            });

            // Setup custom file inputs
            setupCustomFileInput('backgroundImage', 'backgroundImageFileName', 'backgroundImagePreview');
            setupCustomFileInput('heroImage', 'heroImageFileName', 'heroImagePreview');
            setupCustomFileInput('profileImage', 'profileImageFileName', 'profileImagePreview');

            appearanceForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady || !userId) {
                    showIslandNotification('User not authenticated. Please wait.', true);
                    return;
                }

                appearanceLoading.style.display = 'inline-block';
                const appearanceData = {};
                const profileData = {};

                try {
                    // Handle profile name and intro
                    profileData.name = profileNameInput.value;
                    profileData.intro = profileIntroInput.value;

                    // Handle background image upload
                    const backgroundImageFile = backgroundImageInput.files[0];
                    if (backgroundImageFile) {
                        const imageUrl = await uploadImage(backgroundImageFile, `users/${userId}/appearance/backgrounds`);
                        appearanceData.backgroundImage = imageUrl;
                        appearanceData.backgroundColor = ''; // Clear color if image is chosen
                    } else if (selectedBackgroundColorInput.value) { // Only set color if one is selected
                        appearanceData.backgroundColor = selectedBackgroundColorInput.value;
                        appearanceData.backgroundImage = ''; // Clear image if color is chosen
                    }
                    // If neither image nor color is selected, don't update these fields in appearanceData

                    // Handle hero image upload
                    const heroImageFile = heroImageInput.files[0];
                    if (heroImageFile) {
                        const imageUrl = await uploadImage(heroImageFile, `users/${userId}/appearance/hero`);
                        appearanceData.heroImage = imageUrl;
                    }
                    // If no new hero image, do not include heroImage in appearanceData to avoid overwriting

                    // Handle profile image upload
                    const profileImageFile = profileImageInput.files[0];
                    if (profileImageFile) {
                        const imageUrl = await uploadImage(profileImageFile, `users/${userId}/appearance/profile`);
                        appearanceData.profileImage = imageUrl;
                    }
                    // If no new profile image, do not include profileImage in appearanceData to avoid overwriting

                    // Get other form data
                    appearanceData.fontFamily = document.getElementById('fontFamily') ? document.getElementById('fontFamily').value : 'Inter, sans-serif';

                    // Save to Realtime Database using update to only change specified fields
                    const appearanceRef = ref(rtdb, `users/${userId}/appearance`);
                    await update(appearanceRef, appearanceData); // Use update for partial updates

                    const profileRef = ref(rtdb, `users/${userId}/profile`);
                    await update(profileRef, profileData); // Use update for partial updates

                    showIslandNotification('Appearance settings saved successfully!');

                } catch (error) {
                    console.error("Error saving appearance settings:", error);
                    showIslandNotification(`Error saving settings: ${error.message}`, true);
                } finally {
                    appearanceLoading.style.display = 'none';
                }
            });

            /**
             * Loads appearance settings and profile data from Firebase Realtime Database.
             */
            function loadAppearanceSettings() {
                if (!userId) return;

                // Load Appearance Data
                const appearanceRef = ref(rtdb, `users/${userId}/appearance`);
                onValue(appearanceRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        if(document.getElementById('fontFamily')) {
                            document.getElementById('fontFamily').value = data.fontFamily || 'Inter, sans-serif';
                        }

                        // Handle background image or color
                        document.querySelectorAll('.color-square').forEach(sq => sq.classList.remove('selected'));
                        if (data.backgroundImage) {
                            backgroundImagePreview.src = data.backgroundImage;
                            backgroundImagePreview.style.display = 'block';
                            document.getElementById('backgroundImageFileName').textContent = 'File loaded';
                            selectedBackgroundColorInput.value = ''; // Clear selected color
                        } else if (data.backgroundColor) {
                            const selectedSquare = document.querySelector(`.color-square[data-color="${data.backgroundColor}"]`);
                            if (selectedSquare) {
                                selectedSquare.classList.add('selected');
                            }
                            selectedBackgroundColorInput.value = data.backgroundColor;
                            backgroundImagePreview.src = '';
                            backgroundImagePreview.style.display = 'none';
                            document.getElementById('backgroundImageFileName').textContent = 'No file chosen';
                        } else {
                             // Default to first color if neither is set
                            const defaultColor = subtleColors[0];
                            document.querySelector(`.color-square[data-color="${defaultColor}"]`).classList.add('selected');
                            selectedBackgroundColorInput.value = defaultColor;
                            backgroundImagePreview.src = '';
                            backgroundImagePreview.style.display = 'none';
                            document.getElementById('backgroundImageFileName').textContent = 'No file chosen';
                        }


                        if (data.heroImage) {
                            heroImagePreview.src = data.heroImage;
                            heroImagePreview.style.display = 'block';
                            document.getElementById('heroImageFileName').textContent = 'File loaded';
                        } else {
                            heroImagePreview.src = '';
                            heroImagePreview.style.display = 'none';
                            document.getElementById('heroImageFileName').textContent = 'No file chosen';
                        }

                        if (data.profileImage) {
                            profileImagePreview.src = data.profileImage;
                            profileImagePreview.style.display = 'block';
                            document.getElementById('profileImageFileName').textContent = 'File loaded';
                        } else {
                            profileImagePreview.src = '';
                            profileImagePreview.style.display = 'none';
                            document.getElementById('profileImageFileName').textContent = 'No file chosen';
                        }
                    } else {
                        // If no data, set default color selection
                        const defaultColor = subtleColors[0];
                        document.querySelector(`.color-square[data-color="${defaultColor}"]`).classList.add('selected');
                        selectedBackgroundColorInput.value = defaultColor;
                    }
                });

                // Load Profile Data for Name and Intro fields
                const profileRef = ref(rtdb, `users/${userId}/profile`);
                onValue(profileRef, (snapshot) => {
                    const profileData = snapshot.val();
                    if (profileData) {
                        profileNameInput.value = profileData.name || '';
                        profileIntroInput.value = profileData.intro || '';
                    } else {
                        profileNameInput.value = '';
                        profileIntroInput.value = '';
                    }
                });
            }

            // Load settings when the module is initialized and auth is ready
            if (isAuthReady && userId) {
                loadAppearanceSettings();
            }
        }

        // --- Contact Tab Logic ---
        /**
         * Initializes the contact information management functionality.
         * Sets up form submission and loads existing contact info.
         */
        function initContactManager() {
            const contactForm = document.getElementById('contactForm');
            const contactLoading = document.getElementById('contactLoading');

            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady || !userId) {
                    showIslandNotification('User not authenticated. Please wait.', true);
                    return;
                }

                contactLoading.style.display = 'inline-block';
                const formData = new FormData(contactForm);
                const contactData = {
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    website: formData.get('website'),
                    websiteMessage: formData.get('websiteMessage'), // Added websiteMessage
                    address: formData.get('address')
                };

                try {
                    const contactRef = ref(rtdb, `users/${userId}/contacts`);
                    await set(contactRef, contactData);
                    showIslandNotification('Contact information saved successfully!');
                } catch (error) {
                    console.error("Error saving contact info:", error);
                    showIslandNotification(`Error saving contact info: ${error.message}`, true);
                } finally {
                    contactLoading.style.display = 'none';
                }
            });

            /**
             * Loads contact information from Firebase Realtime Database.
             */
            function loadContactInfo() {
                if (!userId) return;
                const contactRef = ref(rtdb, `users/${userId}/contacts`);
                onValue(contactRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        document.getElementById('contactEmail').value = data.email || '';
                        document.getElementById('contactPhone').value = data.phone || '';
                        document.getElementById('contactWebsite').value = data.website || '';
                        document.getElementById('contactWebsiteMessage').value = data.websiteMessage || ''; // Load websiteMessage
                        document.getElementById('contactAddress').value = data.address || '';
                    }
                });
            }

            // Load settings when the module is initialized and auth is ready
            if (isAuthReady && userId) {
                loadContactInfo();
            }
        }

        // --- Social Media Tab Logic ---
        /**
         * Initializes the social media management functionality.
         * Sets up form submission and loads existing social links.
         */
        function initSocialMediaManager() {
            const socialLinksList = document.getElementById('socialLinksList');
            const noSocialLinksMessage = document.getElementById('noSocialLinks');

            // Define the fixed social media platforms and their icons (already in HTML)
            const socialPlatforms = [
                { id: 'instagram', name: 'Instagram', icon: 'fab fa-instagram' },
                { id: 'substack', name: 'Substack', icon: 'fas fa-newspaper' },
                { id: 'tiktok', name: 'TikTok', icon: 'fab fa-tiktok' },
                { id: 'threads', name: 'Threads', icon: 'fab fa-threads' },
                { id: 'reddit', name: 'Reddit', icon: 'fab fa-reddit-alien' },
                { id: 'x', name: 'X (Twitter)', icon: 'fab fa-x-twitter' },
                { id: 'whatsapp', name: 'WhatsApp', icon: 'fab fa-whatsapp' },
                { id: 'facebook', name: 'Facebook', icon: 'fab fa-facebook-f' },
                { id: 'linkedin', name: 'LinkedIn', icon: 'fab fa-linkedin-in' },
                { id: 'medium', name: 'Medium', icon: 'fab fa-medium-m' },
                { id: 'upwork', name: 'Upwork', icon: 'custom-upwork' },
                { id: 'fiverr', name: 'Fiverr', icon: 'custom-fiverr' }
            ];

            /**
             * Attaches event listeners to each social link item.
             * This function is called once after the HTML is rendered.
             */
            function setupSocialLinkListeners() {
                socialPlatforms.forEach(platform => {
                    const listItem = socialLinksList.querySelector(`[data-platform-id="${platform.id}"]`);
                    if (!listItem) return; // Skip if element not found

                    const urlInput = listItem.querySelector('.url-input');
                    const toggleInput = listItem.querySelector('.toggle-switch input');
                    const deleteButton = listItem.querySelector('.delete-btn');

                    // Save on input change (as user types)
                    urlInput.addEventListener('input', async () => {
                        if (!userId) {
                            showIslandNotification('User not authenticated. Please wait.', true);
                            return;
                        }
                        const newUrl = urlInput.value;
                        const newIsActive = toggleInput.checked;
                        const linkRef = ref(rtdb, `users/${userId}/socialMedia/${platform.id}`);

                        if (newUrl.trim() === '' && !newIsActive) {
                            await remove(linkRef); // Remove if both empty and inactive
                            showIslandNotification(`${platform.name} link cleared.`);
                        } else {
                            await set(linkRef, { url: newUrl, isActive: newIsActive });
                            showIslandNotification(`${platform.name} link saved.`);
                        }
                    });

                    // Save on toggle change
                    toggleInput.addEventListener('change', async () => {
                        if (!userId) {
                            showIslandNotification('User not authenticated. Please wait.', true);
                            return;
                        }
                        const newIsActive = toggleInput.checked;
                        const currentUrlForToggle = urlInput.value; // Get current URL from input
                        const linkRef = ref(rtdb, `users/${userId}/socialMedia/${platform.id}`);

                        if (currentUrlForToggle.trim() === '' && !newIsActive) {
                            await remove(linkRef); // Remove if URL is empty and toggle is off
                            showIslandNotification(`${platform.name} link cleared.`);
                        } else {
                            await set(linkRef, { url: currentUrlForToggle, isActive: newIsActive });
                            showIslandNotification(`${platform.name} link ${newIsActive ? 'activated' : 'deactivated'}.`);
                        }
                    });

                    // Handle delete (clears the specific link)
                    deleteButton.addEventListener('click', async () => {
                        if (!userId) {
                            showIslandNotification('User not authenticated. Please wait.', true);
                            return;
                        }
                        // This will remove the data from Firebase, and the onValue listener will re-render
                        const linkRef = ref(rtdb, `users/${userId}/socialMedia/${platform.id}`);
                        await remove(linkRef);
                        showIslandNotification(`${platform.name} link cleared.`);
                        // Manually clear UI after deletion as onValue might be slightly delayed
                        urlInput.value = '';
                        toggleInput.checked = false;
                    });
                });
            }

            /**
             * Loads social media links from Firebase Realtime Database and updates the UI.
             */
            function loadSocialMedia() {
                if (!userId) return;
                const socialMediaRef = ref(rtdb, `users/${userId}/socialMedia`);
                onValue(socialMediaRef, (snapshot) => {
                    const data = snapshot.val();
                    let hasAnyData = false;

                    socialPlatforms.forEach(platform => {
                        const listItem = socialLinksList.querySelector(`[data-platform-id="${platform.id}"]`);
                        if (!listItem) return;

                        const urlInput = listItem.querySelector('.url-input');
                        const toggleInput = listItem.querySelector('.toggle-switch input');

                        const link = data ? data[platform.id] : null;
                        const currentUrl = link ? link.url : '';
                        const isActive = link ? link.isActive : false;

                        urlInput.value = currentUrl;
                        toggleInput.checked = isActive;

                        if (currentUrl.trim() !== '' || isActive) {
                            hasAnyData = true;
                        }
                    });

                    if (!hasAnyData) {
                        noSocialLinksMessage.style.display = 'block';
                    } else {
                        noSocialLinksMessage.style.display = 'none';
                    }
                });
            }

            // Setup listeners once the DOM is ready for the fixed elements
            setupSocialLinkListeners();

            // Load settings when the module is initialized and auth is ready
            if (isAuthReady && userId) {
                loadSocialMedia();
            }
        }

        // --- Activate Card Tab Logic ---
        /**
         * Initializes the NFC card activation functionality.
         * Sets up form submission, live card preview, and loads existing card details.
         * Also handles card order submission and order status display.
         * Integrates EmailJS to send email on card order.
         */
        function initCardManager() {
            const cardForm = document.getElementById('cardForm');
            const cardNameInput = document.getElementById('cardName');
            const cardCtaInput = document.getElementById('cardCta');
            const cardLoading = document.getElementById('cardLoading');
            const cardTypeRadios = document.querySelectorAll('input[name="cardTypeRadio"]');

            const cardLogoUploadInput = document.getElementById('cardLogoUpload');
            const cardLogoFileNameSpan = document.getElementById('cardLogoFileName');
            const cardLogoPreview = document.getElementById('cardLogoPreview');

            const previewName = document.getElementById('previewName');
            const previewLogo = document.getElementById('previewLogo');
            const previewQr = document.getElementById('previewQr');
            const cardPreviewElement = document.querySelector('.card-preview'); // Get the main card preview element
            const cardOrderStatusContainer = document.getElementById('cardOrderStatusContainer');

            // Define card type background images
            const cardBackgrounds = {
                platinum: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Platinum_texture.jpg/640px-Platinum_texture.jpg',
                black: '', // Black is default background-color
                bamboo: 'https://i.pinimg.com/736x/11/f6/40/11f6400d5b0bc565fc0c1fb69e68a471.jpg'
            };

            // Setup custom file input for card logo
            setupCustomFileInput('cardLogoUpload', 'cardLogoFileName', 'cardLogoPreview');

            /**
             * Generates a QR code image and updates the preview.
             * Uses an external QR code API for simplicity.
             * @param {string} text - The text to encode in the QR code.
             */
            function generateQRCode(text) {
                const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=70x70&data=${encodeURIComponent(text)}`;
                const img = new Image();
                img.src = qrImageUrl;
                img.alt = `QR code for ${text}`;
                img.onload = () => {
                    // Clear previous QR code
                    while (previewQr.firstChild) {
                        previewQr.removeChild(previewQr.firstChild);
                    }
                    previewQr.appendChild(img);
                };
                img.onerror = () => {
                    console.error("Failed to load QR code image.");
                    // Fallback: display text if image fails
                    const textNode = document.createElement('div');
                    textNode.textContent = 'QR Error';
                    textNode.style.fontSize = '0.6rem';
                    textNode.style.textAlign = 'center';
                    while (previewQr.firstChild) {
                        previewQr.removeChild(previewQr.firstChild);
                    }
                    previewQr.appendChild(textNode);
                };
            }

            /**
             * Updates the live card preview based on input values and selected card type.
             */
            function updateCardPreview() {
                previewName.textContent = cardNameInput.value || 'Your Name';
                // Use the fixed prefilled link for QR code
                // Get the current user's "name" field from RTDB for CTA
                let usernameForCta = currentUsername || '{username}';
                if (userId && rtdb) {
                    const profileRef = ref(rtdb, `users/${userId}/profile`);
                    onValue(profileRef, (snapshot) => {
                        const profileData = snapshot.val();
                        if (profileData && profileData.name) {
                            usernameForCta = profileData.name;
                        }
                    }, { onlyOnce: true });
                }
                const fixedCta = `https://anju.pages.cc/r?id=${usernameForCta}`;
                cardCtaInput.value = fixedCta;
                generateQRCode(fixedCta); // Generate QR based on fixed CTA

                const selectedCardType = document.querySelector('input[name="cardTypeRadio"]:checked')?.value || 'black';
                if (cardBackgrounds[selectedCardType]) {
                    cardPreviewElement.style.backgroundImage = `url('${cardBackgrounds[selectedCardType]}')`;
                    cardPreviewElement.style.backgroundColor = 'transparent'; // Ensure background color doesn't show
                } else {
                    cardPreviewElement.style.backgroundImage = 'none';
                    cardPreviewElement.style.backgroundColor = '#000'; // Default black
                }

                // Update logo preview if a file is selected, else show default icon
                if (cardLogoPreview.src && cardLogoPreview.src !== window.location.href) {
                    previewLogo.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = cardLogoPreview.src;
                    img.alt = 'Card Logo';
                    previewLogo.appendChild(img);
                } else {
                    previewLogo.innerHTML = `<i class="fas fa-id-card"></i>`;
                }
            }

            // Add event listeners for live preview updates
            cardNameInput.addEventListener('input', updateCardPreview);
            cardTypeRadios.forEach(radio => {
                radio.addEventListener('change', updateCardPreview);
            });
            cardLogoUploadInput.addEventListener('change', () => {
                updateCardPreview();
            });

            /**
             * Loads card details from Firebase Realtime Database.
             */
            function loadCardDetails() {
                if (!userId) return;
                const cardRef = ref(rtdb, `users/${userId}/cards/card01`);
                onValue(cardRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        document.getElementById('cardName').value = data.name || '';
                        // Ignore cta from DB, always use fixed prefilled link
                        // document.getElementById('cardCta').value = data.cta || '';

                        // Set selected radio button for card type
                        cardTypeRadios.forEach(radio => {
                            if (radio.value === data.type) {
                                radio.checked = true;
                            } else {
                                radio.checked = false;
                            }
                        });

                        // Load logo if exists
                        if (data.logoUrl) {
                            cardLogoPreview.src = data.logoUrl;
                            cardLogoPreview.style.display = 'block';
                            cardLogoFileNameSpan.textContent = 'File loaded';
                        } else {
                            cardLogoPreview.src = '';
                            cardLogoPreview.style.display = 'none';
                            cardLogoFileNameSpan.textContent = 'No file chosen';
                        }

                        // Update preview
                        previewName.textContent = data.name || 'Your Name';
                        updateCardPreview();
                    } else {
                        // Default to 'black' if no data exists
                        document.querySelector('input[name="cardTypeRadio"][value="black"]').checked = true;
                        cardLogoPreview.src = '';
                        cardLogoPreview.style.display = 'none';
                        cardLogoFileNameSpan.textContent = 'No file chosen';
                        updateCardPreview();
                    }
                });
            }

            /**
             * Loads card order status from "card_orders" folder and updates UI.
             * If order exists, disables form and shows timeline.
             */
            // Define globally so it can be called from anywhere
            function loadCardOrderStatus() {
                if (!userId) return;
                const orderRef = ref(rtdb, `card_orders/${userId}`);
                onValue(orderRef, (snapshot) => {
                const orderData = snapshot.val();
                if (orderData) {
                    // Disable form inputs and submit button except cardCta (which is disabled anyway)
                    cardForm.querySelectorAll('input, button').forEach(el => {
                    if (el !== activateCardSubmitBtn && el !== cardCtaInput) el.disabled = true;
                    });
                    activateCardSubmitBtn.disabled = true;

                    // Show timeline tracking
                    renderOrderTimeline(orderData.status);
                } else {
                    // Enable form inputs and submit button
                    cardForm.querySelectorAll('input, button').forEach(el => {
                    el.disabled = false;
                    });
                    activateCardSubmitBtn.disabled = false;

                    // Clear timeline UI
                    cardOrderStatusContainer.innerHTML = '';
                }
                });
            }

            /**
             * Renders the order timeline with statuses:
             * processing (orange) -> intransit (blue) -> completed (green)
             * @param {string} currentStatus
             */
            function renderOrderTimeline(currentStatus) {
                const statuses = ['processing', 'intransit', 'completed'];
                const statusLabels = {
                    processing: 'Processing',
                    intransit: 'In Transit',
                    completed: 'Completed'
                };
                const statusColors = {
                    processing: '#ea580c', // orange
                    intransit: '#2563eb', // blue
                    completed: '#15803d' // green
                };

                let html = '<div class="order-timeline" aria-label="Card order status timeline">';
                statuses.forEach((status, idx) => {
                    let classes = 'order-step';
                    if (status === currentStatus) {
                        classes += ' active';
                        if (status === 'completed') classes += ' completed';
                        else if (status === 'intransit') classes += ' intransit';
                    } else if (statuses.indexOf(currentStatus) > idx) {
                        // Past steps are considered completed (green)
                        classes += ' active completed';
                    }
                    html += `
                        <div class="${classes}" aria-current="${status === currentStatus ? 'step' : 'false'}" tabindex="0">
                            <div class="circle" style="background-color: ${statusColors[status]}"></div>
                            ${statusLabels[status]}
                        </div>
                    `;
                });
                html += '</div>';
                cardOrderStatusContainer.innerHTML = html;
            }

            // Initialize EmailJS
            emailjs.init('SbtBpCSywSOQ8GYk1');

            cardForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady || !userId) {
                    showIslandNotification('User not authenticated. Please wait.', true);
                    return;
                }

                cardLoading.style.display = 'inline-block';
                const formData = new FormData(cardForm);
                const selectedCardType = document.querySelector('input[name="cardTypeRadio"]:checked').value;

                // Use fixed prefilled CTA link
                const fixedCta = `https://anju.pages.cc/r?id=${currentUsername || '{username}'}`;

                // Handle logo upload if any
                let logoUrl = '';
                const logoFile = cardLogoUploadInput.files[0];
                if (logoFile) {
                    try {
                        logoUrl = await uploadImage(logoFile, `users/${userId}/cards/logos`);
                    } catch (error) {
                        console.error("Error uploading logo:", error);
                        showIslandNotification(`Error uploading logo: ${error.message}`, true);
                        cardLoading.style.display = 'none';
                        return;
                    }
                }

                const cardData = {
                    type: selectedCardType,
                    name: formData.get('name') || '',
                    cta: fixedCta,
                    logoUrl: logoUrl
                };

                try {
                    // Save card details under users/{userId}/cards/card01
                    const cardRef = ref(rtdb, `users/${userId}/cards/card01`);
                    await set(cardRef, cardData);

                    // Also create a card order entry under card_orders/{userId} with status "processing"
                    const orderRef = ref(rtdb, `card_orders/${userId}`);
                    const orderData = {
                        cardDetails: cardData,
                        status: "processing",
                        createdAt: serverTimestamp()
                    };
                    await set(orderRef, orderData);

                    showIslandNotification('NFC Card order placed successfully!');

                    // Send email via EmailJS
                    const emailParams = {
                        to_email: 'jvkechris@gmail.com',
                        subject: `New NFC Card Order from User ${userId}`,
                        message: `User ID: ${userId}\nCard Name: ${cardData.name}\nCall to Action: ${cardData.cta}\nCard Type: ${cardData.type}`
                    };
                    emailjs.send('service_5lzs0ab', 'template_ilii5cb', emailParams)
                        .then(() => {
                            console.log('EmailJS: Order email sent successfully.');
                        })
                        .catch((error) => {
                            console.error('EmailJS: Failed to send order email:', error);
                        });

                    // Disable form and show timeline
                    loadCardOrderStatus();

                } catch (error) {
                    console.error("Error saving card details or placing order:", error);
                    showIslandNotification(`Error saving card details: ${error.message}`, true);
                } finally {
                    cardLoading.style.display = 'none';
                }
            });

            // Load settings when the module is initialized and auth is ready
            if (isAuthReady && userId) {
                loadCardDetails();
                loadCardOrderStatus();
            }
        }
        

        // --- Overview Tab - Stats Logic ---
        /**
         * Draws a simple line chart on a canvas element.
         * @param {string} canvasId - The ID of the canvas element.
         * @param {Array<Object>} data - An array of data objects, each with 'date' and 'amount' properties.
         * @param {string} label - The label for the chart.
         */
        function drawChart(canvasId, data, label) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            // Ensure canvas dimensions are set for proper rendering
            // Get computed style for width/height to ensure responsiveness
            const computedStyle = getComputedStyle(canvas.parentElement);
            canvas.width = parseInt(computedStyle.width);
            canvas.height = parseInt(computedStyle.height);

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear previous drawing

            if (data.length === 0) {
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Sort data by date
            data.sort((a, b) => new Date(a.date) - new Date(b.date));

            const dates = data.map(d => {
                const date = new Date(d.date);
                return `${date.getMonth() + 1}/${date.getDate()}`; // MM/DD format
            });
            const amounts = data.map(d => d.amount);

            const maxAmount = Math.max(...amounts);
            const minAmount = Math.min(...amounts);

            const padding = 30;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;

            // Draw X-axis (dates)
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.strokeStyle = '#9ca3af';
            ctx.stroke();

            // Draw Y-axis (amounts)
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(padding, padding);
            ctx.stroke();

            // Draw X-axis labels (dates)
            ctx.fillStyle = '#6b7280';
            ctx.font = '10px Inter, sans-serif';
            ctx.textAlign = 'center';
            const xStep = chartWidth / (dates.length - 1 || 1);
            dates.forEach((date, i) => {
                ctx.fillText(date, padding + i * xStep, canvas.height - padding + 15);
            });

            // Draw Y-axis labels (amounts)
            ctx.textAlign = 'right';
            const yAxisLabelsCount = 5; // Number of labels on Y-axis
            for (let i = 0; i <= yAxisLabelsCount; i++) {
                const yValue = minAmount + (maxAmount - minAmount) * (i / yAxisLabelsCount);
                const yPos = canvas.height - padding - (chartHeight * (i / yAxisLabelsCount));
                ctx.fillText(Math.round(yValue), padding - 5, yPos + 3);
            }

            // Draw data points and lines
            ctx.beginPath();
            ctx.strokeStyle = '#15803d'; /* Green line for chart */
            ctx.lineWidth = 2;
            ctx.fillStyle = '#15803d'; /* Green points for chart */

            amounts.forEach((amount, i) => {
                const x = padding + i * xStep;
                const y = canvas.height - padding - (chartHeight * ((amount - minAmount) / (maxAmount - minAmount || 1)));

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                ctx.arc(x, y, 3, 0, Math.PI * 2); // Draw point
            });
            ctx.stroke();
        }

        /**
         * Loads statistics data from Firebase Realtime Database and draws charts.
         */
        function loadStats() {
            if (!userId) return;

            // Load Page Visits Stats (general page views)
            const pageVisitsRef = ref(rtdb, `users/${userId}/visits`); // Using 'visits' for general page views
            onValue(pageVisitsRef, (snapshot) => {
                const data = snapshot.val();
                const pageVisitsData = [];
                if (data) {
                    for (const key in data) {
                        pageVisitsData.push({
                            date: data[key].datestamp,
                            amount: data[key].amount
                        });
                    }
                }
                drawChart('pageVisitsChart', pageVisitsData, 'Page Visits');
                // Show or hide empty icons container
                document.getElementById('emptyPageVisitsIcons').style.display = pageVisitsData.length === 0 ? 'block' : 'none';
            });

            // Load Website Visits Stats (clicks on external website link)
            const websiteVisitsRef = ref(rtdb, `users/${userId}/websiteVisits`);
            onValue(websiteVisitsRef, (snapshot) => {
                const data = snapshot.val();
                const websiteVisitsData = [];
                if (data) {
                    for (const key in data) {
                        websiteVisitsData.push({
                            date: data[key].datestamp,
                            amount: data[key].amount
                        });
                    }
                }
                drawChart('websiteVisitsChart', websiteVisitsData, 'Website Clicks');
                // Show or hide empty icons container
                document.getElementById('emptyWebsiteClicksIcons').style.display = websiteVisitsData.length === 0 ? 'block' : 'none';
            });

            // Load Card Taps Stats
            const cardTapsRef = ref(rtdb, `users/${userId}/cardTaps`);
            onValue(cardTapsRef, (snapshot) => {
                const data = snapshot.val();
                const cardTapsData = [];
                if (data) {
                    for (const key in data) {
                        cardTapsData.push({
                            date: data[key].datestamp,
                            amount: data[key].amount
                        });
                    }
                }
                drawChart('cardTapsChart', cardTapsData, 'Card Taps');
                // Show or hide empty icons container
                document.getElementById('emptyCardTapsIcons').style.display = cardTapsData.length === 0 ? 'block' : 'none';
            });
        }


        /**
         * Simulates checking username availability.
         * In a real application, this would involve a backend call.
         * @param {string} username - The username to check.
         * @returns {Promise<boolean>} - True if available, false otherwise.
         */
        async function simulateUsernameAvailability(username) {
            // Simulate some delay
            await new Promise(resolve => setTimeout(resolve, 500));
            // Simple simulation: 'testuser' is taken, others are available
            return username.toLowerCase() !== 'testuser';
        }

        /**
         * Loads and updates the content of the Overview tab.
         * This includes profile details, link-in-bio, and stats.
         */
        function loadOverviewContent() {
            if (!userId) {
                console.warn("User ID not available for overview content loading.");
                return;
            }

            const overviewProfileName = document.getElementById('overviewProfileName');
            const overviewProfilePic = document.getElementById('overviewProfilePic');
            const linkInBioDisplay = document.getElementById('linkInBioDisplay');
            const actualLinkInBio = document.getElementById('actualLinkInBio');
            const copyLinkBtn = document.getElementById('copyLinkBtn');
            const setupLinkBtn = document.getElementById('setupLinkBtn');
            const linkInBioMessage = document.getElementById('linkInBioMessage');

            // Load Profile Details
            const profileRef = ref(rtdb, `users/${userId}/profile`);
            const userRef = ref(rtdb, `users/${userId}`);
            onValue(profileRef, (snapshot) => {
                const profileData = snapshot.val();
                const userData = snapshot.val();
                const name = profileData?.name || 'Your Name';
                const profilePicUrl = userData.photoURL || 'https://placehold.co/80x80/aabbcc/ffffff?text=P';
                const username = profileData?.username || '';

                overviewProfileName.textContent = name;
                //console userData

                currentUsername = username; // Update global currentUsername for modal pre-fill

                if (username) {
                    linkInBioDisplay.style.display = 'flex'; // Show the actual link
                    setupLinkBtn.style.display = 'none'; // Hide the setup button
                    actualLinkInBio.textContent = `anju.pages.cc/r?id=${username}`;
                    linkInBioMessage.textContent = ''; // Clear any previous messages
                    const baseUrl = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? 'http://127.0.0.1:5500' : 'https://app.myahju.com';    //'https://anju.pages.cc'
                    actualLinkInBio.textContent = `${baseUrl}/r/?id=${username}`;
                    linkInBioMessage.textContent = ''; // Clear any previous messages
                    copyLinkBtn.onclick = () => copyTextToClipboard(`${baseUrl}/r/?id=${username}`);
                } else {
                    linkInBioDisplay.style.display = 'none'; // Hide the actual link
                    setupLinkBtn.style.display = 'block'; // Show the setup button
                    linkInBioMessage.textContent = 'Set up your personalized link-in-bio!';
                }
            });
            onValue(userRef, (snapshot) => {
                const userData = snapshot.val();
                if (userData && userData.photoURL) {
                    overviewProfilePic.src = userData.photoURL;
                } else {
                    overviewProfilePic.src = 'https://placehold.co/80x80/aabbcc/ffffff?text=P'; // Default placeholder
                }
            });
            // Load Stats (already handled by loadStats function)
            loadStats();
            // Load Recent Activity
            loadRecentActivity(currentPage);
            // Load User Lookbook
            loadUserLookbook();
        }

        // --- Recent Activity Logic ---
        const recentActivityList = document.getElementById('recentActivityList');
        const noRecentActivityMessage = document.getElementById('noRecentActivity');
        const activityPagination = document.getElementById('activityPagination');
        const prevActivityPageBtn = document.getElementById('prevActivityPage');
        const nextActivityPageBtn = document.getElementById('nextActivityPage');
        const activityPageInfo = document.getElementById('activityPageInfo');

        prevActivityPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderRecentActivity();
            }
        });

        nextActivityPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(allActivityData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderRecentActivity();
            }
        });

        /**
         * Renders the current page of recent activity data.
         */
        function renderRecentActivity() {
            recentActivityList.innerHTML = ''; // Clear current list

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = allActivityData.slice(startIndex, endIndex);

            if (paginatedData.length === 0) {
                noRecentActivityMessage.style.display = 'block';
                activityPagination.style.display = 'none';
                return;
            } else {
                noRecentActivityMessage.style.display = 'none';
                activityPagination.style.display = 'flex';
            }

            paginatedData.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';

                let iconClass = 'fas fa-info-circle'; // Default icon
                let deviceSummary = '';

                if (activity.type === 'websiteVisit') {
                    iconClass = 'fas fa-globe'; // Website icon
                    // Add device details if available
                    if (activity.device) {
                        const userAgent = activity.device.userAgent || 'N/A';
                        const platform = activity.device.platform || 'N/A';
                        const screenResolution = activity.device.screenResolution || 'N/A';

                        // Attempt to parse user agent for browser/OS for a more readable summary
                        let browser = 'Unknown Browser';
                        let os = 'Unknown OS';

                        // Simple User-Agent parsing (can be expanded with a library if needed)
                        if (userAgent.includes('Chrome') && !userAgent.includes('Edge')) {
                            browser = 'Chrome';
                        } else if (userAgent.includes('Firefox')) {
                            browser = 'Firefox';
                        } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                            browser = 'Safari';
                        } else if (userAgent.includes('Edge')) {
                            browser = 'Edge';
                        } else if (userAgent.includes('Opera') || userAgent.includes('OPR')) {
                            browser = 'Opera';
                        }

                        if (userAgent.includes('Windows')) {
                            os = 'Windows';
                        } else if (userAgent.includes('Macintosh') || userAgent.includes('Mac OS')) {
                            os = 'macOS';
                        } else if (userAgent.includes('Android')) {
                            os = 'Android';
                        } else if (userAgent.includes('iPhone') || userAgent.includes('iPad')) {
                            os = 'iOS';
                        } else if (userAgent.includes('Linux')) {
                            os = 'Linux';
                        }

                        deviceSummary = `from ${os} (${browser}) - ${screenResolution}`;
                    }
                } else if (activity.type === 'cardTap') {
                    iconClass = 'fas fa-id-card'; // Card icon
                } else if (activity.type === 'profileUpdate') {
                    iconClass = 'fas fa-user-edit'; // Profile update icon
                }
                // Add more icon mappings as needed for other activity types

                const timestamp = activity.time ? new Date(activity.time).toLocaleString() : 'N/A';
                const ipAddress = activity.ipAddress || 'N/A';

                item.innerHTML = `
                    <div class="activity-icon"><i class="${iconClass}" aria-hidden="true"></i></div>
                    <div class="activity-details">
                        <div class="activity-message">${activity.message}</div>
                        <div class="activity-meta">
                            IP: ${ipAddress} <br>
                            Device: ${deviceSummary}
                        </div>
                        <div class="activity-meta">Time: ${timestamp}</div>
                    </div>
                `;
                recentActivityList.appendChild(item);
            });

            updatePaginationControls();
        }

        /**
         * Updates the state of pagination buttons and info.
         */
        function updatePaginationControls() {
            const totalPages = Math.ceil(allActivityData.length / itemsPerPage);
            activityPageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
            prevActivityPageBtn.disabled = currentPage === 1;
            nextActivityPageBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        /**
         * Loads recent activity data from Firebase Realtime Database.
         */
        function loadRecentActivity() {
            if (!userId) return;
            const activityRef = ref(rtdb, `users/${userId}/recentActivity`);
            onValue(activityRef, (snapshot) => {
                const data = snapshot.val();
                allActivityData = [];
                if (data) {
                    // Convert object to array and sort by timestamp (descending)
                    allActivityData = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    })).sort((a, b) => b.time - a.time);
                }
                currentPage = 1; // Reset to first page on data change
                renderRecentActivity();
            });
        }

        // --- Overview Modal Specific Logic ---
        function initOverviewManagerModalLogic() {
            // Modal elements
            const linkSetupModal = document.getElementById('linkSetupModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalStep1 = document.getElementById('modalStep1');
            const modalStep2 = document.getElementById('modalStep2');
            const usernameInput = document.getElementById('usernameInput');
            const usernameAvailabilityMessage = document.getElementById('usernameAvailabilityMessage');
            const checkUsernameBtn = document.getElementById('checkUsernameBtn');
            const nextStep1Btn = document.getElementById('nextStep1Btn');
            const sendVerificationEmailBtn = document.getElementById('sendVerificationEmailBtn');
            const iHaveVerifiedBtn = document.getElementById('iHaveVerifiedBtn');
            const emailVerificationMessage = document.getElementById('emailVerificationMessage');
            const setupLinkBtn = document.getElementById('setupLinkBtn'); // Get the button from the overview tab

            // Function to open the modal
            setupLinkBtn.addEventListener('click', () => {
                linkSetupModal.classList.add('show');
                // Reset to step 1
                modalStep1.classList.add('active');
                modalStep2.classList.remove('active');
                usernameInput.value = currentUsername; // Pre-fill if exists
                usernameAvailabilityMessage.textContent = '';
                nextStep1Btn.disabled = true;
                emailVerificationMessage.textContent = '';
                usernameInput.focus();
            });

            // Function to close the modal
            closeModalBtn.addEventListener('click', () => {
                linkSetupModal.classList.remove('show');
            });

            // Close modal if clicking outside content (optional, but good UX)
            linkSetupModal.addEventListener('click', (e) => {
                if (e.target === linkSetupModal) {
                    linkSetupModal.classList.remove('show');
                }
            });

            // Step 1: Username Logic
            usernameInput.addEventListener('input', () => {
                usernameAvailabilityMessage.textContent = ''; // Clear message on input
                nextStep1Btn.disabled = true; // Disable next until checked
            });

            checkUsernameBtn.addEventListener('click', async () => {
                const desiredUsername = usernameInput.value.trim();
                if (desiredUsername.length < 3) {
                    usernameAvailabilityMessage.textContent = 'Username must be at least 3 characters.';
                    usernameAvailabilityMessage.style.color = 'red';
                    nextStep1Btn.disabled = true;
                    return;
                }

                // Simulate availability check
                const isAvailable = await simulateUsernameAvailability(desiredUsername);

                if (isAvailable) {
                    usernameAvailabilityMessage.textContent = `Username "${desiredUsername}" is available!`;
                    usernameAvailabilityMessage.style.color = 'green';
                    nextStep1Btn.disabled = false;
                } else {
                    usernameAvailabilityMessage.textContent = `Username "${desiredUsername}" is taken. Try another.`;
                    usernameAvailabilityMessage.style.color = 'red';
                    nextStep1Btn.disabled = true;
                }
            });

            nextStep1Btn.addEventListener('click', async () => {
                const desiredUsername = usernameInput.value.trim();
                if (!userId) {
                    showIslandNotification('User not authenticated. Cannot save username.', true);
                    return;
                }

                try {
                    const profileRef = ref(rtdb, `users/${userId}/profile`);
                    // Only update username, keep other profile data if it exists
                    await update(profileRef, { username: desiredUsername }); // Use update for partial merge
                    showIslandNotification('Username saved successfully!');
                    currentUsername = desiredUsername; // Update global variable

                    const user = auth.currentUser;
                    if (user && user.emailVerified) {
                        currentUserEmailVerified = true;
                        showIslandNotification('Email already verified. Link-in-bio is active!');
                        linkSetupModal.classList.remove('show');
                        loadOverviewContent(); // Refresh overview to show new link
                    } else {
                        currentUserEmailVerified = false;
                        modalStep1.classList.remove('active');
                        modalStep2.classList.add('active');
                    }
                } catch (error) {
                    console.error("Error saving username:", error);
                    showIslandNotification(`Error saving username: ${error.message}`, true);
                }
            });

            // Step 2: Email Verification Logic
            sendVerificationEmailBtn.addEventListener('click', async () => {
                if (!auth.currentUser) {
                    showIslandNotification('No authenticated user to send email to.', true);
                    return;
                }
                try {
                    await sendEmailVerification(auth.currentUser);
                    emailVerificationMessage.textContent = 'Check your email - we sent an account verification link!';
                    emailVerificationMessage.style.color = 'green';
                    showIslandNotification('Verification email sent!');
                } catch (error) {
                    console.error("Error sending verification email:", error);
                    showIslandNotification(`Error sending email: ${error.message}`, true);
                }
            });

            iHaveVerifiedBtn.addEventListener('click', async () => {
                if (!auth.currentUser) {
                    showIslandNotification('No authenticated user.', true);
                    return;
                }
                // Reload user to get latest email verification status
                await auth.currentUser.reload();
                const user = auth.currentUser;
                if (user && user.emailVerified) {
                    currentUserEmailVerified = true;
                    showIslandNotification('Email successfully verified! Your link-in-bio is now active.');
                    linkSetupModal.classList.remove('show');
                    loadOverviewContent(); // Refresh overview to show new link
                } else {
                    showIslandNotification('Email not yet verified. Please check your inbox.', true);
                    emailVerificationMessage.textContent = 'Still not verified. Please try again after verifying your email.';
                    emailVerificationMessage.style.color = 'orange';
                }
            });
        }

        // --- Image Scraper Logic ---
        const coverImageInput = document.getElementById("coverImageInput");
        const extractFromSiteBtn = document.getElementById("extractFromSiteBtn");
        const imageScraperModal = document.getElementById("imageScraperModal");

        const imgScraperCloseBtn = document.getElementById("img-scraper-close");
        const imgScraperFetchBtn = document.getElementById("img-scraper-fetch-btn");
        const scraperUrlInput = document.getElementById("img-scraper-url");
        const statusText = document.getElementById("img-scraper-status");
        const errorText = document.getElementById("img-scraper-error");
        const resultsContainer = document.getElementById("img-scraper-results-container");

        function isValidUrl(url) {
          try {
            new URL(url);
            return true;
          } catch {
            return false;
          }
        }

        function resolveUrl(base, relative) {
          try {
            return new URL(relative, base).href;
          } catch {
            return null;
          }
        }

        function openImageScraperModal() {
          imageScraperModal.classList.add("show");
          resultsContainer.innerHTML = "<p class='pm-initial-message'>Enter a URL and click 'Fetch Images'.</p>";
          statusText.textContent = '';
          errorText.textContent = '';

          if (isValidUrl(coverImageInput.value)) {
            scraperUrlInput.value = coverImageInput.value;
            scrapeImagesFromUrl(coverImageInput.value);
          } else {
            scraperUrlInput.value = '';
          }
        }

        function closeImageScraperModal() {
          imageScraperModal.classList.remove("show");
        }

        async function scrapeImagesFromUrl(url) {
          statusText.textContent = "Fetching...";
          errorText.textContent = '';
          resultsContainer.innerHTML = "";

          try {
            const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
            const result = await response.json();
            const htmlString = result.contents;

            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, "text/html");

            const imagesSet = new Set();

            // 1. Normal <img> tags
            [...doc.querySelectorAll('img')].forEach(img => {
              const src = resolveUrl(url, img.getAttribute('src') || img.getAttribute('data-src') || '');
              if (src) imagesSet.add(src);
            });

            // 2. Background images in style attributes
            [...doc.querySelectorAll('*')].forEach(el => {
              const style = el.getAttribute('style');
              if (style && style.includes('url(')) {
                const matches = style.match(/url\(["']?(.*?)["']?\)/gi);
                if (matches) {
                  matches.forEach(m => {
                    const path = m.match(/url\(["']?(.*?)["']?\)/)?.[1];
                    const src = resolveUrl(url, path);
                    if (src) imagesSet.add(src);
                  });
                }
              }
            });

            // 3. Meta og:image
            const metaOgImage = doc.querySelector('meta[property="og:image"]');
            if (metaOgImage?.content) {
              const ogUrl = resolveUrl(url, metaOgImage.content);
              if (ogUrl) imagesSet.add(ogUrl);
            }

            // 4. Filter out tiny or tracking images
            const validImages = [...imagesSet].filter(src =>
              !src.includes('1x1') &&
              !src.includes('pixel') &&
              !src.includes('data:image') &&
              /\.(jpe?g|png|gif|webp|svg|bmp)(\?|$)/i.test(src)
            );

            if (validImages.length === 0) {
              resultsContainer.innerHTML = "<p>No usable images found.</p>";
            } else {
              validImages.forEach(src => {
                const img = document.createElement("img");
                img.src = src;
                img.loading = "lazy";
                img.title = src;
                img.addEventListener("click", () => {
                  coverImageInput.value = src;
                  closeImageScraperModal();
                });
                resultsContainer.appendChild(img);
              });
            }

            statusText.textContent = `Found ${validImages.length} image(s).`;
          } catch (err) {
            console.error("Scraping failed:", err);
            errorText.textContent = "Failed to fetch or parse the page.";
          }
        }

        // Event Listeners
        extractFromSiteBtn.addEventListener("click", openImageScraperModal);
        imgScraperCloseBtn.addEventListener("click", closeImageScraperModal);
        imgScraperFetchBtn.addEventListener("click", () => {
          const url = scraperUrlInput.value.trim();
          if (isValidUrl(url)) {
            scrapeImagesFromUrl(url);
          } else {
            errorText.textContent = "Please enter a valid URL.";
          }
        });

        // --- Lookbook Feature Logic ---
        const lookbookImagesGrid = document.getElementById('lookbookImagesGrid');
        const completeLookbookBtn = document.getElementById('completeLookbookBtn');
        const lookbookImportStatus = document.getElementById('lookbookImportStatus');
        const lookbookModal = document.getElementById('lookbookModal');
        const lookbookCloseBtn = document.getElementById('lookbookCloseBtn');
        const lookbookNameInput = document.getElementById('lookbookNameInput');
        const saveLookbookBtn = document.getElementById('saveLookbookBtn');
        const cancelLookbookBtn = document.getElementById('cancelLookbookBtn');
        const userLookbookContainer = document.getElementById('userLookbookContainer');
        const noLookbookMessage = document.getElementById('noLookbookMessage');
        const lookbookDisplay = document.getElementById('lookbookDisplay');
        const lookbookTitle = document.getElementById('lookbookTitle');
        const lookbookImagesDisplay = document.getElementById('lookbookImagesDisplay');
        const editLookbookBtn = document.getElementById('editLookbookBtn');
        const deleteLookbookBtn = document.getElementById('deleteLookbookBtn');

        // Open Lookbook modal to name the lookbook
        function openLookbookModal() {
            lookbookNameInput.value = userLookbookData ? userLookbookData.name : '';
            saveLookbookBtn.disabled = lookbookNameInput.value.trim() === '';
            lookbookModal.classList.add('show');
            lookbookNameInput.focus();
        }

        // Close Lookbook modal
        function closeLookbookModal() {
            lookbookModal.classList.remove('show');
        }

        // Enable save button only if name input is not empty
        lookbookNameInput.addEventListener('input', () => {
            saveLookbookBtn.disabled = lookbookNameInput.value.trim() === '';
        });

        // Save lookbook to database (create or update)
        saveLookbookBtn.addEventListener('click', async () => {
            const lookbookName = lookbookNameInput.value.trim();
            if (!lookbookName) return;

            if (!userId) {
                showIslandNotification('User not authenticated. Please wait.', true);
                return;
            }

            if (lookbookSelectedImages.size === 0) {
                showIslandNotification('No images selected for the lookbook.', true);
                return;
            }

            try {
                // Prepare lookbook data
                const lookbookData = {
                    name: lookbookName,
                    images: Array.from(lookbookSelectedImages),
                    updatedAt: serverTimestamp()
                };

                if (userLookbookId) {
                    // Update existing lookbook
                    const lookbookRef = ref(rtdb, `users/${userId}/lookbooks/${userLookbookId}`);
                    await update(lookbookRef, lookbookData);
                    showIslandNotification(`Lookbook "${lookbookName}" updated successfully!`);
                } else {
                    // Create new lookbook (only one allowed)
                    const lookbooksRef = ref(rtdb, `users/${userId}/lookbooks`);
                    const newLookbookRef = push(lookbooksRef);
                    await set(newLookbookRef, {
                        ...lookbookData,
                        createdAt: serverTimestamp()
                    });
                    userLookbookId = newLookbookRef.key;
                    showIslandNotification(`Lookbook "${lookbookName}" saved successfully!`);
                }

                userLookbookData = { ...lookbookData };

                // Clear selection and UI
                lookbookSelectedImages.clear();
                lookbookImagesGrid.innerHTML = '';
                completeLookbookBtn.disabled = true;
                coverImageInput.value = '';
                lookbookImportStatus.textContent = '';

                closeLookbookModal();
                loadUserLookbook(); // Refresh display

            } catch (error) {
                console.error("Error saving lookbook:", error);
                showIslandNotification(`Error saving lookbook: ${error.message}`, true);
            }
        });

        cancelLookbookBtn.addEventListener('click', () => {
            closeLookbookModal();
        });

        lookbookCloseBtn.addEventListener('click', () => {
            closeLookbookModal();
        });

        // When user clicks "Import Images" in Social Media advanced section
        extractFromSiteBtn.addEventListener('click', async () => {
            const url = coverImageInput.value.trim();
            if (!isValidUrl(url)) {
                lookbookImportStatus.textContent = 'Please enter a valid URL.';
                lookbookImportStatus.classList.add('text-red-600');
                return;
            }
            lookbookImportStatus.textContent = 'Fetching images...';
            lookbookImportStatus.classList.remove('text-red-600');
            lookbookImagesGrid.innerHTML = '';
            lookbookSelectedImages.clear();
            completeLookbookBtn.disabled = true;

            try {
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                const result = await response.json();
                const htmlString = result.contents;

                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlString, "text/html");

                const imagesSet = new Set();

                // 1. Normal <img> tags
                [...doc.querySelectorAll('img')].forEach(img => {
                    const src = resolveUrl(url, img.getAttribute('src') || img.getAttribute('data-src') || '');
                    if (src) imagesSet.add(src);
                });

                // 2. Background images in style attributes
                [...doc.querySelectorAll('*')].forEach(el => {
                    const style = el.getAttribute('style');
                    if (style && style.includes('url(')) {
                        const matches = style.match(/url\(["']?(.*?)["']?\)/gi);
                        if (matches) {
                            matches.forEach(m => {
                                const path = m.match(/url\(["']?(.*?)["']?\)/)?.[1];
                                const src = resolveUrl(url, path);
                                if (src) imagesSet.add(src);
                            });
                        }
                    }
                });

                // 3. Meta og:image
                const metaOgImage = doc.querySelector('meta[property="og:image"]');
                if (metaOgImage?.content) {
                    const ogUrl = resolveUrl(url, metaOgImage.content);
                    if (ogUrl) imagesSet.add(ogUrl);
                }

                // 4. Filter out tiny or tracking images
                const validImages = [...imagesSet].filter(src =>
                    !src.includes('1x1') &&
                    !src.includes('pixel') &&
                    !src.includes('data:image') &&
                    /\.(jpe?g|png|gif|webp|svg|bmp)(\?|$)/i.test(src)
                );

                if (validImages.length === 0) {
                    lookbookImportStatus.textContent = "No usable images found.";
                    lookbookImportStatus.classList.add('text-red-600');
                    return;
                }

                // Add "Select All" button above images grid
                const selectAllBtn = document.createElement('button');
                selectAllBtn.textContent = 'Select All';
                selectAllBtn.className = 'btn-primary mb-2 w-full sm:w-auto';
                selectAllBtn.type = 'button';
                selectAllBtn.addEventListener('click', () => {
                    let allSelected = true;
                    // Check if all images are already selected
                    const imgs = lookbookImagesGrid.querySelectorAll('img');
                    imgs.forEach(img => {
                        if (!img.classList.contains('selected')) {
                            allSelected = false;
                        }
                    });
                    if (allSelected) {
                        // Deselect all
                        imgs.forEach(img => {
                            img.classList.remove('selected');
                            lookbookSelectedImages.delete(img.src);
                        });
                    } else {
                        // Select all
                        imgs.forEach(img => {
                            img.classList.add('selected');
                            lookbookSelectedImages.add(img.src);
                        });
                    }
                    updateCompleteLookbookButton();
                });
                lookbookImagesGrid.appendChild(selectAllBtn);

                // Render images in grid with selection capability
                validImages.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = `Imported image from ${url}`;
                    img.loading = "lazy";
                    img.tabIndex = 0;
                    img.setAttribute('role', 'button');
                    img.addEventListener('click', () => {
                        if (lookbookSelectedImages.has(src)) {
                            lookbookSelectedImages.delete(src);
                            img.classList.remove('selected');
                        } else {
                            lookbookSelectedImages.add(src);
                            img.classList.add('selected');
                        }
                        updateCompleteLookbookButton();
                    });
                    img.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            img.click();
                        }
                    });
                    lookbookImagesGrid.appendChild(img);
                });

                lookbookImportStatus.textContent = `Found ${validImages.length} image(s). Select images to add to your lookbook.`;
                lookbookImportStatus.classList.remove('text-red-600');
                updateCompleteLookbookButton();
            } catch (err) {
                console.error("Scraping failed:", err);
                lookbookImportStatus.textContent = "Failed to fetch or parse the page.";
                lookbookImportStatus.classList.add('text-red-600');
            }
        });

        // Update Complete Lookbook button text and disabled state
        function updateCompleteLookbookButton() {
            const count = lookbookSelectedImages.size;
            completeLookbookBtn.textContent = `Complete Lookbook${count > 0 ? ' - ' + count : ''}`;
            completeLookbookBtn.disabled = count === 0;
        }

        // When user clicks "Complete Lookbook" button
        completeLookbookBtn.addEventListener('click', () => {
            if (lookbookSelectedImages.size === 0) return;
            openLookbookModal();
        });

        // Load user's lookbook (only one allowed)
        function loadUserLookbook() {
            if (!userId) return;
            const lookbooksRef = ref(rtdb, `users/${userId}/lookbooks`);
            onValue(lookbooksRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Only one lookbook allowed, get first
                    const keys = Object.keys(data);
                    if (keys.length > 0) {
                        userLookbookId = keys[0];
                        userLookbookData = data[userLookbookId];
                        displayUserLookbook();
                        return;
                    }
                }
                // No lookbook found
                userLookbookId = null;
                userLookbookData = null;
                noLookbookMessage.style.display = 'block';
                lookbookDisplay.classList.add('hidden');
            });
        }

        // Display user's lookbook in the overview tab
        function displayUserLookbook() {
            if (!userLookbookData) return;
            noLookbookMessage.style.display = 'none';
            lookbookDisplay.classList.remove('hidden');
            lookbookTitle.textContent = userLookbookData.name || 'Untitled Lookbook';
            lookbookImagesDisplay.innerHTML = '';
            if (Array.isArray(userLookbookData.images)) {
                userLookbookData.images.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = `Lookbook image: ${userLookbookData.name}`;
                    img.loading = "lazy";
                    lookbookImagesDisplay.appendChild(img);
                });
            }
        }

        // Edit lookbook button click
        editLookbookBtn.addEventListener('click', () => {
            if (!userLookbookData) return;
            // Pre-fill selection with existing images
            lookbookSelectedImages = new Set(userLookbookData.images || []);
            // Clear current grid and render selected images for editing
            lookbookImagesGrid.innerHTML = '';
            // Render selected images as selected
            lookbookSelectedImages.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = `Lookbook image for editing`;
                img.loading = "lazy";
                img.tabIndex = 0;
                img.setAttribute('role', 'button');
                img.classList.add('selected');
                img.addEventListener('click', () => {
                    if (lookbookSelectedImages.has(src)) {
                        lookbookSelectedImages.delete(src);
                        img.classList.remove('selected');
                    } else {
                        lookbookSelectedImages.add(src);
                        img.classList.add('selected');
                    }
                    updateCompleteLookbookButton();
                });
                img.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        img.click();
                    }
                });
                lookbookImagesGrid.appendChild(img);
            });
            updateCompleteLookbookButton();
            openLookbookModal();
        });

        // Delete lookbook button click
        deleteLookbookBtn.addEventListener('click', async () => {
            if (!userLookbookId || !userId) return;
            if (!confirm('Are you sure you want to delete your lookbook? This action cannot be undone.')) return;
            try {
                const lookbookRef = ref(rtdb, `users/${userId}/lookbooks/${userLookbookId}`);
                await remove(lookbookRef);
                userLookbookId = null;
                userLookbookData = null;
                noLookbookMessage.style.display = 'block';
                lookbookDisplay.classList.add('hidden');
                showIslandNotification('Lookbook deleted successfully.');
            } catch (error) {
                console.error('Error deleting lookbook:', error);
                showIslandNotification('Failed to delete lookbook.', true);
            }
        });

        // --- Main Application Logic ---
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize tab navigation immediately
            initTabNavigation();

            // Initialize Firebase and wait for authentication to be ready
            await initializeFirebase();

            // Once Firebase auth is ready, initialize managers and load initial overview content
            if (isAuthReady && userId) {
                console.log("Firebase auth is ready. Initializing managers and loading initial overview.");
                initAppearanceManager();
                initContactManager();
                initSocialMediaManager();
                initCardManager();
                initOverviewManagerModalLogic(); // Initialize the modal logic for overview
                loadOverviewContent(); // Explicitly load overview content on initial ready state
            } else {
                console.warn("Firebase authentication not fully ready. Data loading might be delayed.");
                // If not authenticated, the "Not logged in" notification is already shown by initializeFirebase
                // and no other managers should be initialized until authenticated.
            }
        });
  </script>
 </body>
</html>
