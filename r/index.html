<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   User Profile - Anju.cc
  </title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com">
  </script>
  <!-- Inter Font -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Font Awesome for Icons (using v6 for consistency with dashboard) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
  <style>
   /* Reset and base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        *::-webkit-scrollbar {
            display: none;
        }
        body {
            background-color: #f9fafb;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            color: #374151;
            overflow: hidden;
        }

        /* Animations */
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulseScale {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Intro fade in for container */
        .fade-in-up {
            animation: fadeInUp 0.8s ease forwards;
            opacity: 0;
        }

        /* Container */
        .profile-container {
            max-width: 28rem;
            width: 100%;
            height: 100vh;
            max-height: 720px;
            overflow: scroll;
        }

        /* Profile Card */
        .profile-card {
            position: relative;
            border-radius: 0.6rem;
            overflow: hidden;
            height: 45vh;
            width: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: .7rem;
            color: white;
            user-select: none;
            margin-bottom: 1.5rem;
        }
        .profile-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            z-index: 0;
            border-radius: 0.6rem;
        }
        .profile-card > * {
            position: relative;
            z-index: 1;
        }
        .profile-card img {
            border-radius: 9999px;
            height: 6rem;
            width: 6rem;
            object-fit: cover;
            transition: transform 0.3s ease;
            cursor: default;
            image-rendering: -webkit-optimize-contrast;
        }
        .profile-card img:hover {
            transform: scale(1.1);
        }
        .profile-card .name {
            font-size: 1.5rem;
            font-weight: 700;
            user-select: none;
        }
        .profile-card .intro {
            max-width: 20rem;
            text-align: center;
            color: #e5e7eb;
            user-select: none;
        }
        .socials {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        .social-icon {
            font-size: 1.5rem;
            color: white;
            transition: transform 0.3s ease, color 0.3s ease;
            cursor: pointer;
            user-select: none;
        }
        .social-icon:hover {
            color: #b37ca6;
            transform: scale(1.2) rotate(10deg);
        }
        .social-icon.instagram:hover {
            color: #ec4899;
        }
        .social-icon.reddit:hover {
            color: #f97316;
        }
        .social-icon.threads:hover {
            color: #3b82f6;
        }
        .social-icon.tiktok:hover {
            color: #000000;
        }
        .social-icon.whatsapp:hover {
            color: #25D366;
        }
        .social-icon.facebook:hover {
            color: #1877F2;
        }
        .social-icon.linkedin:hover {
            color: #0A66C2;
        }
        .social-icon.medium:hover {
            color: #00ab6c;
        }
        .social-icon.upwork:hover {
            color: #6fda44;
        }
        .social-icon.fiverr:hover {
            color: #1dbf73;
        }

        /* Main Content */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            overflow: hidden;
        }

        /* Tabs */
        .tab-switcher {
            display: flex;
            border-bottom: 1px solid #d1d5db;
        }
        .tab {
            flex-grow: 1;
            padding: 0.75rem 0;
            text-align: center;
            font-weight: 600;
            color: #4b5563;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: color 0.3s ease, border-color 0.3s ease;
            user-select: none;
            background: none;
            border: none;
            font-size: 1rem;
        }
        .tab:hover {
            color: #7c3aed;
        }
        .tab-active {
            border-bottom-color: #b37ca6;
            color: #b37ca6;
            font-weight: 700;
        }

        /* Tab content */
        .tab-content {
            flex-grow: 1;
            overflow-y: auto;
            margin-top: 1rem;
            padding-right: 0.25rem;
        }

        /* Scroll animation */
        .scroll-animate {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        .scroll-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .hidden {
            display: none !important;
        }
        section#book-call {
    margin-bottom: 5em;
}
        /* Form */
        form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .custom-input {
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1.5px solid #9ca3af;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: white;
        }
        .custom-input:focus-within {
            border-color: #7c3aed;
            box-shadow: 0 0 5px #b37ca6;
        }
        .custom-input label {
            color: #6b7280;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }
        .custom-input input {
            flex-grow: 1;
            background: transparent;
            border: none;
            outline: none;
            font-size: 1rem;
            color: #374151;
            caret-color: #7c3aed;
        }
        .custom-input input::placeholder {
            color: #9ca3af;
        }
        .custom-input input:disabled {
            background-color: #f9fafb;
            cursor: not-allowed;
        }

        /* Availability selector */
        .availability-container {
            margin-top: 2rem;
            width: 100%;
        }
        .availability-title {
            font-weight: 700;
            font-size: 1.25rem;
            color: #6b21a8;
            margin-bottom: 1rem;
            user-select: none;
        }
        .availability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }
        .availability-option {
            cursor: pointer;
            border: 2px solid #d1d5db;
            border-radius: 1rem;
            padding: 1rem 1.25rem;
            background: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            position: relative;
        }
        .availability-option:hover {
            border-color: #a78bfa;
            box-shadow: 0 6px 12px rgba(167, 139, 250, 0.4);
        }
        .availability-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }
        .availability-option input[type="radio"]:checked + label {
            border-color: #7c3aed;

        }
        .availability-option label {
            cursor: pointer;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            border-radius: 1rem;
            padding: 0.75rem 0.5rem;
            font-weight: 600;
            color: #4b5563;
            transition: color 0.3s ease;
            user-select: none;
        }
        .availability-option input[type="radio"]:checked + label .day {
            color: #7c3aed;
        }
        .availability-option label .day {
            font-size: 1.1rem;
        }
        .availability-option label .time {
            font-size: 0.875rem;
            color: #9ca3af;
        }
        /* Custom radio circle */
        .availability-option label::before {
            content: "";
            display: block;
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            margin-bottom: 0.5rem;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        .availability-option input[type="radio"]:checked + label::before {
            border-color: #7c3aed;
            background-color: #7c3aed;
        }
        /* Focus ring for accessibility */
        .availability-option input[type="radio"]:focus + label {
            outline: 2px solid #a78bfa;
            outline-offset: 2px;
        }

        /* Button mesh blur effect */
        .mesh {
            background: radial-gradient(circle at 20% 20%, rgba(255, 69, 0, 0.8), transparent 40%),
                radial-gradient(circle at 50% 40%, rgba(70, 130, 180, 0.8), transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(10, 10, 10, 0.9), transparent 60%);
            background-blend-mode: screen;
            filter: blur(80px);
            height: 13em;
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            border-radius: 9999px;
            z-index: 0;
        }

        /* Button hover pulse */
        button[type="submit"] {
            position: relative;
            background: transparent;
            width: 100%;
            border: none;
            height: 3em;
            overflow: hidden;
            border-radius: 9999px;
            font-weight: 700;
            color: #b37ca6;
            cursor: pointer;
            transition: color 0.3s ease;
            font-size: 1rem;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        button[type="submit"]:hover {
            color: #7b4f7a;
            animation: pulseScale 1.2s infinite;
        }
        button[type="submit"]:disabled {
            cursor: not-allowed;
            opacity: 0.6;
            animation: none;
        }
        button[type="submit"] .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 1.5em;
            height: 1.5em;
            animation: spin 1s linear infinite;
            display: none;
        }
        button[type="submit"].loading .spinner {
            display: block;
        }
        button[type="submit"].loading .btn-text {
            display: none;
        }

        /* User website message fixed bottom */
        .user-website-message {
            position: fixed;
            width: 80%;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            background: #eeeeee;
            color: #333333;
            text-align: center;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            user-select: none;
            font-size: 1rem;
            z-index: 10;
        }
        .user-website-message:hover,
        .user-website-message:focus {
            background-color: #b37ca6;
            color: white;
            outline: none;
        }

        /* Instagram posts grid */
        .from-instagram .posts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 4rem;
        }
        .from-instagram img {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
            height: 200px;
            object-fit: cover;
            user-select: none;
        }
        .from-instagram img:hover {
            transform: scale(1.05);
        }

        /* Responsive tweaks */
        @media (max-width: 400px) {
                .availability-grid {
        display: block;
        white-space: nowrap;
        overflow: scroll;
    }
    .availability-option {
        display: inline-flex;
    }
            .profile-container {
                max-width: 100%;
                height: auto;
                max-height: none;
            }
            .profile-card {
                height: auto;
                padding: 2rem 0;
            }
            .from-instagram .posts-grid {
                max-height: none;
            }
            .user-website-message {
                width: 90%;
                left: 5%;
                font-size: 0.9rem;
                transform: none;
            }
        }

        /* Loading and Error States */
        .loading-state, .error-state {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #6b7280;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #f9fafb;
            z-index: 100;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #b37ca6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-top: 1rem;
        }
        
        /* Modal-style notification box */
        .notification-box {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4b5563;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            max-width: 90%;
            text-align: center;
        }
        .notification-box.visible {
            opacity: 1;
            visibility: visible;
        }
        .notification-box.error {
            background-color: #dc2626;
        }
        @media (max-width: 48em) {
            body {
                display: block;
                overflow: scroll;
            }
            section#from-instagram {
    margin-bottom: 6em;
}
        }
  </style>
 </head>
 <body>
  <div class="loading-state" id="loadingState">
   <div class="loading-spinner">
   </div>
   <p>
    Loading profile...
   </p>
  </div>
  <div class="error-state" id="errorState" style="display: none;">
   <p>
    Profile not found or an error occurred.
   </p>
   <p class="text-sm mt-2">
    Please check the username in the URL.
   </p>
  </div>
  <div class="profile-container fade-in-up" id="app-container" style="display: none;">
   <!-- Profile Card -->
   <div class="profile-card" id="profileCardHeader">
    <img alt="Profile Picture" height="100" id="profileImage" loading="lazy" src="https://storage.googleapis.com/a1aa/image/cdde57b6-0974-4888-7d6e-410a62152e92.jpg" width="100"/>
    <p class="name" id="profileName">
     Loading Name...
    </p>
    <p class="intro" id="profileIntro">
     A brief introduction.
    </p>
    <div class="socials" id="socialLinksContainer">
     <!-- Social icons will be dynamically inserted here -->
    </div>
   </div>
   <!-- Main Content -->
   <div class="main-content">
    <div class="tab-switcher" role="tablist">
     <button aria-controls="book-call" aria-selected="true" class="tab tab-active" data-tab="book-call" id="tab-book-call" role="tab" tabindex="0" type="button">
      Connect with me
     </button>
     <button aria-controls="from-instagram" aria-selected="false" class="tab" data-tab="from-instagram" id="tab-from-instagram" role="tab" style="display: none;" tabindex="-1" type="button">
      Lookbook
     </button>
    </div>
    <div class="tab-content" tabindex="0">
     <section aria-labelledby="tab-book-call" class="book-call tab-content-section visible" id="book-call" role="tabpanel">
      <form novalidate="" onsubmit="handleBookCall(event); return false;">
       <div class="custom-input">
        <label for="visitor-name">
         <i class="fas fa-user">
         </i>
        </label>
        <input aria-required="true" autocomplete="name" id="visitor-name" name="visitor-name" placeholder="Your name" required="" type="text"/>
       </div>
       <div class="custom-input">
        <label for="visitor-email">
         <i class="fas fa-envelope">
         </i>
        </label>
        <input aria-required="true" autocomplete="email" id="visitor-email" name="visitor-email" placeholder="Your email" required="" type="email"/>
       </div>
       <div class="custom-input">
        <label for="visitor-phone">
         <i class="fas fa-phone-alt">
         </i>
        </label>
        <input aria-required="false" autocomplete="tel" id="visitor-phone" name="visitor-phone" placeholder="Your phone number" type="tel"/>
       </div>
       <!-- Availability Date Selector -->
       <div class="availability-container">
        <p class="availability-title" id="availability-label">
         Select your availability
        </p>
        <div aria-labelledby="availability-label" class="availability-grid" role="radiogroup">
         <div class="availability-option">
          <input aria-label="Monday 9 AM to 12 PM" id="monday" name="availability" type="radio" value="Monday 9 AM - 12 PM"/>
          <label for="monday" tabindex="0">
           <span class="day">
            Monday
           </span>
           <span class="time">
            9 AM - 12 PM
           </span>
          </label>
         </div>
         <div class="availability-option">
          <input aria-label="Tuesday 1 PM to 4 PM" id="tuesday" name="availability" type="radio" value="Tuesday 1 PM - 4 PM"/>
          <label for="tuesday" tabindex="0">
           <span class="day">
            Tuesday
           </span>
           <span class="time">
            1 PM - 4 PM
           </span>
          </label>
         </div>
         <div class="availability-option">
          <input aria-label="Wednesday 10 AM to 1 PM" id="wednesday" name="availability" type="radio" value="Wednesday 10 AM - 1 PM"/>
          <label for="wednesday" tabindex="0">
           <span class="day">
            Wednesday
           </span>
           <span class="time">
            10 AM - 1 PM
           </span>
          </label>
         </div>
         <div class="availability-option">
          <input aria-label="Thursday 2 PM to 5 PM" id="thursday" name="availability" type="radio" value="Thursday 2 PM - 5 PM"/>
          <label for="thursday" tabindex="0">
           <span class="day">
            Thursday
           </span>
           <span class="time">
            2 PM - 5 PM
           </span>
          </label>
         </div>
         <div class="availability-option">
          <input aria-label="Friday 9 AM to 12 PM" id="friday" name="availability" type="radio" value="Friday 9 AM - 12 PM"/>
          <label for="friday" tabindex="0">
           <span class="day">
            Friday
           </span>
           <span class="time">
            9 AM - 12 PM
           </span>
          </label>
         </div>
         <div class="availability-option">
          <input aria-label="Saturday 11 AM to 2 PM" id="saturday" name="availability" type="radio" value="Saturday 11 AM - 2 PM"/>
          <label for="saturday" tabindex="0">
           <span class="day">
            Saturday
           </span>
           <span class="time">
            11 AM - 2 PM
           </span>
          </label>
         </div>
        </div>
       </div>
       <button id="bookCallSubmitBtn" type="submit">
        <div class="mesh">
        </div>
        <span class="btn-text">
         Let's talk
        </span>
        <div class="spinner">
        </div>
       </button>
      </form>
     </section>
     <section aria-labelledby="tab-from-instagram" class="from-instagram tab-content-section" id="from-instagram" role="tabpanel" style="display: none;">
      <div style="color:#374151; text-align:center;">
       <p style="margin-bottom:1rem; font-size:1.125rem; font-weight:600;">
        Lookbook
       </p>
       <div aria-label="Lookbook gallery" class="posts-grid" id="lookbook-posts-grid">
       </div>
      </div>
     </section>
    </div>
   </div>
   <!-- create an ahju profile styled link here -->
    <div style="text-align: center; margin-top: 1rem; font-size: 0.875rem; color: #9ca3af;">
     Powered by <a href="https://anju.cc" rel="noopener" style="color: #b37ca6; font-weight: 600;" target="_blank">Anju.cc</a>
     </div>
     

  </div>
  <a class="user-website-message" href="" id="userWebsiteMessage" role="button" style="display: none;" tabindex="0" target="_blank">
   Visit my portfolio
  </a>
  <div class="notification-box" id="notificationBox">
  </div>
  <!-- EmailJS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
  </script>
  <!-- Firebase SDK Imports -->
  <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, update, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // --- Firebase Configuration ---
        // NOTE: Replace these with your own Firebase project credentials.
        const firebaseConfig = {
            apiKey: "AIzaSyD-GCRFbpLQwU55kShhS-DtNSNOPEySQ_g",
            authDomain: "octen-29d12.firebaseapp.com",
            databaseURL: "https://octen-29d12-default-rtdb.firebaseio.com",
            projectId: "octen-29d12",
            storageBucket: "octen-29d12.appspot.com",
            messagingSenderId: "1095439842170",
            appId: "1:1095439842170:web:da0dc8a2c414c60f33f4c3",
            measurementId: "G-483MYXKNVL"
        };
        
        // --- EmailJS Configuration ---
       // You can find these on your EmailJS dashboard.
        const EMAILJS_SERVICE_ID = 'service_g526hs7';
        const EMAILJS_TEMPLATE_ID = 'template_17shwsu';
        const EMAILJS_PUBLIC_KEY = 'fk0t_Vo-cQNadneie';

        // --- Global Variables ---
        let profileOwnerUserId = null;
        let profileOwnerEmail = null;
        let app, rtdb;
        let profileOwnerPhone = null;
        
        // --- DOM Elements ---
        const appContainer = document.getElementById('app-container');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const profileCardHeader = document.getElementById('profileCardHeader');
        const profileImage = document.getElementById('profileImage');
        const profileName = document.getElementById('profileName');
        const profileIntro = document.getElementById('profileIntro');
        const socialLinksContainer = document.getElementById('socialLinksContainer');
        const visitorNameInput = document.getElementById('visitor-name');
        const visitorEmailInput = document.getElementById('visitor-email');
        const visitorPhoneInput = document.getElementById('visitor-phone');
        const bookCallSubmitBtn = document.getElementById('bookCallSubmitBtn');
        const userWebsiteMessage = document.getElementById('userWebsiteMessage');
        const tabBookCall = document.getElementById('tab-book-call');
        const tabFromInstagram = document.getElementById('tab-from-instagram');
        const contentBookCall = document.getElementById('book-call');
        const contentFromInstagram = document.getElementById('from-instagram');
        const lookbookPostsGrid = document.getElementById('lookbook-posts-grid');
        const notificationBox = document.getElementById('notificationBox');
        const availabilityInputs = () => document.querySelectorAll('input[name="availability"]');

        // --- Social Media Platform Icons Mapping (Font Awesome) ---
        const socialIcons = {
            instagram: 'fab fa-instagram',
            substack: 'fas fa-newspaper',
            tiktok: 'fab fa-tiktok',
            threads: 'bi bi-threads',
            reddit: 'fab fa-reddit-alien',
            x: 'bi bi-twitter-x',
            whatsapp: 'fab fa-whatsapp',
            facebook: 'fab fa-facebook-f',
            linkedin: 'fab fa-linkedin-in',
            medium: 'fab fa-medium',
            upwork: 'fab fa-upwork',
            fiverr: 'fab fa-fiverr',
        };

        // --- Utility Functions ---
        function showNotification(message, isError = false) {
            notificationBox.textContent = message;
            notificationBox.classList.remove('error');
            if (isError) {
                notificationBox.classList.add('error');
            }
            notificationBox.classList.add('visible');
            setTimeout(() => {
                notificationBox.classList.remove('visible');
            }, 5000);
        }

        function getUsernameFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        async function getPublicIpAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip || 'Unknown';
            } catch (error) {
                console.error("Error fetching IP address:", error);
                return 'Unknown';
            }
        }

        function getDeviceDetails() {
            return {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                screenResolution: `${window.screen.width}x${window.screen.height}`
            };
        }

        function updateWebsiteButton(url, message) {
            const userWebsiteMessage = document.getElementById('userWebsiteMessage');
            if (url && message) {
                userWebsiteMessage.textContent = message;
                userWebsiteMessage.href = url;
                const trackAndOpen = async () => {
                    await trackWebsiteVisit(url);
                    window.open(url, '_blank');
                };
                userWebsiteMessage.onclick = trackAndOpen;
                userWebsiteMessage.onkeypress = (event) => {
                    if (event.key === 'Enter') {
                        trackAndOpen();
                    }
                };
                userWebsiteMessage.style.display = 'block';
            } else {
                userWebsiteMessage.style.display = 'none';
            }
        }

        async function trackWebsiteVisit(websiteUrl) {
            const today = new Date().toISOString().slice(0, 10);
            const websiteVisitRef = ref(rtdb, `users/${profileOwnerUserId}/websiteVisits/${today}`);
            const recentActivityRef = ref(rtdb, `users/${profileOwnerUserId}/recentActivity`);

            try {
                const ipAddress = await getPublicIpAddress();
                const deviceDetails = getDeviceDetails();

                onValue(websiteVisitRef, async (snapshot) => {
                    const currentData = snapshot.val();
                    const currentAmount = currentData ? currentData.amount : 0;
                    await set(websiteVisitRef, { amount: currentAmount + 1, datestamp: today });
                }, { onlyOnce: true });

                await push(recentActivityRef, {
                    message: `Visited website: ${websiteUrl} (from ${ipAddress})`,
                    type: 'websiteVisit',
                    ipAddress: ipAddress,
                    device: deviceDetails,
                    time: serverTimestamp()
                });
            } catch (error) {
                console.error("Error tracking website visit:", error);
            }
        }

        async function incrementPageVisitCount() {
            const today = new Date().toISOString().slice(0, 10);
            const pageVisitRef = ref(rtdb, `users/${profileOwnerUserId}/visits/${today}`);
            try {
                onValue(pageVisitRef, async (snapshot) => {
                    const currentData = snapshot.val();
                    const currentAmount = currentData ? currentData.amount : 0;
                    await set(pageVisitRef, { amount: currentAmount + 1, datestamp: today });
                }, { onlyOnce: true });
            } catch (error) {
                console.error("Error incrementing page visit count:", error);
            }
        }
        
        // Disable booking form fields and button
        function disableBookingFields() {
            visitorEmailInput.disabled = true;
            visitorPhoneInput.disabled = true;
            availabilityInputs().forEach(input => input.disabled = true);
            bookCallSubmitBtn.disabled = true;
        }
        // Enable booking form fields and button
        function enableBookingFields() {
            visitorEmailInput.disabled = false;
            visitorPhoneInput.disabled = false;
            availabilityInputs().forEach(input => input.disabled = false);
            bookCallSubmitBtn.disabled = false;
        }

        // --- Main Data Loading Function ---
        async function loadUserProfile(username) {
            loadingState.style.display = 'flex';
            appContainer.style.display = 'none';
            errorState.style.display = 'none';

            if (!username) {
                loadingState.style.display = 'none';
                errorState.style.display = 'flex';
                errorState.querySelector('p').textContent = 'No username provided in the URL (e.g., ?id=yourusername).';
                return;
            }

            let userIdToLoad = null;
            const profilesRef = ref(rtdb, `users`);
            try {
                const profilesSnapshot = await new Promise(resolve => onValue(profilesRef, resolve, { onlyOnce: true }));
                const allUsersData = profilesSnapshot.val();

                if (allUsersData) {
                    for (const uid in allUsersData) {
                        if (allUsersData[uid].profile && allUsersData[uid].profile.username && allUsersData[uid].profile.username.toLowerCase() === username.toLowerCase()) {
                            userIdToLoad = uid;
                            break;
                        }
                    }
                }
            } catch (error) {
                console.error("Error fetching user profiles:", error);
                loadingState.style.display = 'none';
                errorState.style.display = 'flex';
                errorState.querySelector('p').textContent = `Error fetching profiles: ${error.message}`;
                return;
            }

            if (!userIdToLoad) {
                loadingState.style.display = 'none';
                errorState.style.display = 'flex';
                errorState.querySelector('p').textContent = `Profile for username "${username}" not found.`;
                return;
            }

            profileOwnerUserId = userIdToLoad;
            incrementPageVisitCount();

            // Load Profile Data
            onValue(ref(rtdb, `users/${profileOwnerUserId}/profile`), (snapshot) => {
                const profileData = snapshot.val();
                if (profileData) {
                    profileName.textContent = profileData.name || 'User Name';
                    profileIntro.textContent = profileData.intro || 'A brief introduction.';
                    profileImage.src = profileData.profilePicUrl || 'https://placehold.co/100x100/aabbcc/ffffff?text=P';
                    profileImage.alt = `Profile picture of ${profileData.name || 'User'}`;
                }
            });

            // Load Appearance Data
            onValue(ref(rtdb, `users/${profileOwnerUserId}/appearance`), (snapshot) => {
                const appearanceData = snapshot.val();
                if (appearanceData) {
                    if (appearanceData.heroImage) {
                        profileCardHeader.style.backgroundImage = `url('${appearanceData.heroImage}')`;
                        profileCardHeader.style.backgroundColor = 'transparent';
                    } else if (appearanceData.backgroundColor) {
                        profileCardHeader.style.backgroundImage = 'none';
                        profileCardHeader.style.backgroundColor = appearanceData.backgroundColor;
                    } else {
                        profileCardHeader.style.backgroundImage = `url('https://t4.ftcdn.net/jpg/06/06/29/05/360_F_606290597_zYC7dtQc8l8zjjQ2belxIyB3L9LkBtne.jpg')`;
                        profileCardHeader.style.backgroundColor = 'transparent';
                    }
                    if (appearanceData.profileImage) {
                        profileImage.src = appearanceData.profileImage;
                    }
                } else {
                    profileCardHeader.style.backgroundImage = `url('https://t4.ftcdn.net/jpg/06/06/29/05/360_F_606290597_zYC7dtQc8l8zjjQ2belxIyB3L9LkBtne.jpg')`;
                    profileCardHeader.style.backgroundColor = 'transparent';
                    profileImage.src = 'https://cdn.dribbble.com/userupload/26458491/file/still-b40631fe6510df808dfe57d8ae67cb72.png?resize=400x0';
                }
            });

            // Load Contact Data and get owner's email and phone
            onValue(ref(rtdb, `users/${profileOwnerUserId}/contacts`), (snapshot) => {
                const contactData = snapshot.val();
                if (contactData) {
                    updateWebsiteButton(contactData.website, contactData.websiteMessage || 'Visit my portfolio');
                    profileOwnerPhone = contactData.phone || null;
                    // After loading contacts, update social icons to include WhatsApp if phone exists
                    updateSocialLinksWithWhatsApp(profileOwnerPhone);
                } else {
                    updateWebsiteButton('', '');
                    profileOwnerPhone = null;
                    updateSocialLinksWithWhatsApp(null);
                }
            });
            // Load email directly from email field directly under userid
            onValue(ref(rtdb, `users/${profileOwnerUserId}`), (snapshot) => {
                const userData = snapshot.val();
                if (userData && userData.email) {
                    profileOwnerEmail = userData.email;
                    console.log(`Profile owner email loaded: ${profileOwnerEmail}`);
                } else {
                    profileOwnerEmail = null;
                }
            });

            // Load Social Media Links
            onValue(ref(rtdb, `users/${profileOwnerUserId}/socialMedia`), (snapshot) => {
                const socialData = snapshot.val();
                socialLinksContainer.innerHTML = '';
                if (socialData) {
                    for (const platformId in socialData) {
                        const link = socialData[platformId];
                        if (link.isActive && link.url) {
                            const iconClass = socialIcons[platformId];
                            if (iconClass) {
                                const anchor = document.createElement('a');
                                anchor.href = link.url;
                                anchor.target = '_blank';
                                anchor.rel = 'noopener noreferrer';
                                anchor.className = `social-icon ${platformId}`;
                                anchor.setAttribute('aria-label', platformId.charAt(0).toUpperCase() + platformId.slice(1));
                                anchor.innerHTML = `<i class="${iconClass}"></i>`;
                                socialLinksContainer.appendChild(anchor);
                            }
                        }
                    }
                }
                // After loading social media, add WhatsApp if phone exists
                updateSocialLinksWithWhatsApp(profileOwnerPhone);
            });

            // Load Lookbook Data
            onValue(ref(rtdb, `users/${profileOwnerUserId}/lookbooks`), (snapshot) => {
                const lookbookData = snapshot.val();
                lookbookPostsGrid.innerHTML = '';
                let hasImages = false;

                if (lookbookData) {
                    for (const lookbookId in lookbookData) {
                        const imagesArray = lookbookData[lookbookId].images;
                        if (imagesArray && Array.isArray(imagesArray)) {
                            imagesArray.forEach((imageUrl, index) => {
                                if (imageUrl) {
                                    hasImages = true;
                                    const img = document.createElement('img');
                                    img.src = imageUrl;
                                    img.alt = `Lookbook image ${index + 1}`;
                                    img.setAttribute('loading', 'lazy');
                                    img.setAttribute('width', '200');
                                    img.setAttribute('height', '200');
                                    img.setAttribute('tabindex', '0');
                                    lookbookPostsGrid.appendChild(img);
                                }
                            });
                        }
                    }
                }

                if (hasImages) {
                    tabFromInstagram.style.display = 'block';
                } else {
                    tabFromInstagram.style.display = 'none';
                    contentFromInstagram.style.display = 'none';
                }
            });

            // Enable booking fields for everyone
            enableBookingFields();
            loadingState.style.display = 'none';
            appContainer.style.display = 'block';
        }

        // Add WhatsApp icon link if phone exists
        function updateSocialLinksWithWhatsApp(phone) {
            // Remove existing WhatsApp icon if any
            const existingWhatsapp = socialLinksContainer.querySelector('.social-icon.whatsapp');
            if (existingWhatsapp) {
                existingWhatsapp.remove();
            }
            if (phone && phone.trim() !== '') {
                // Normalize phone number: remove spaces, dashes, parentheses, plus signs
                const normalizedPhone = phone.replace(/[\s\-()+]/g, '');
                const waLink = `https://wa.me/${normalizedPhone}`;
                const anchor = document.createElement('a');
                anchor.href = waLink;
                anchor.target = '_blank';
                anchor.rel = 'noopener noreferrer';
                anchor.className = 'social-icon whatsapp';
                anchor.setAttribute('aria-label', 'WhatsApp');
                anchor.innerHTML = `<i class="${socialIcons.whatsapp}"></i>`;
                socialLinksContainer.appendChild(anchor);
            }
        }

        // --- Tab Switching Logic ---
        const tabs = document.querySelectorAll(".tab");

        tabs.forEach((tab) => {
            tab.addEventListener("click", () => {
                tabs.forEach((t) => {
                    t.classList.remove("tab-active");
                    t.setAttribute("aria-selected", "false");
                    t.setAttribute("tabindex", "-1");
                    t.style.color = "#4b5563";
                    t.style.fontWeight = "600";
                });
                tab.classList.add("tab-active");
                tab.setAttribute("aria-selected", "true");
                tab.setAttribute("tabindex", "0");
                tab.style.color = "#b37ca6";
                tab.style.fontWeight = "700";
                tab.focus();

                const target = tab.getAttribute("data-tab");
                document.querySelectorAll('.tab-content-section').forEach(section => {
                    section.classList.remove('visible');
                    section.style.display = 'none';
                });

                if (target === "book-call") {
                    contentBookCall.style.display = 'block';
                    void contentBookCall.offsetWidth;
                    contentBookCall.classList.add("visible");
                } else if (target === "from-instagram") {
                    contentFromInstagram.style.display = 'block';
                    void contentFromInstagram.offsetWidth;
                    contentFromInstagram.classList.add("visible");
                }
            });
        });

        // --- Book Call Functionality ---
        window.handleBookCall = async function(event) {
            event.preventDefault();

            const visitorName = visitorNameInput.value.trim();
            const visitorEmail = visitorEmailInput.value;
            const visitorPhone = visitorPhoneInput.value;
            const selectedAvailability = document.querySelector('input[name="availability"]:checked');
            
            if (!visitorName) {
                showNotification("Please enter your name.", true);
                return;
            }

            // Basic validation
            if (!visitorEmail || !selectedAvailability) {
                showNotification("Please provide your email and select an availability.", true);
                return;
            }
            // Load email directly from email field directly under userid
            onValue(ref(rtdb, `users/${profileOwnerUserId}`), (snapshot) => {
                const userData = snapshot.val();
                if (userData && userData.email) {
                    profileOwnerEmail = userData.email;
                    console.log(`Profile owner email loaded: ${profileOwnerEmail}`);
                } else {
                    profileOwnerEmail = null;
                }
            });
            if (!profileOwnerUserId || !profileOwnerEmail) {
                showNotification("Error: Profile owner information not available. Cannot book a call.", true);
                return;
            }

            bookCallSubmitBtn.disabled = true;
            bookCallSubmitBtn.classList.add('loading');

            const bookingData = {
                visitorName,
                visitorEmail,
                visitorPhone,
                availability: selectedAvailability.value,
                timestamp: serverTimestamp(), // Use RTDB's serverTimestamp
            };

            const name = `Myahju Bookings`;
            const emailSubject = `New Call Booking from Your Portfolio`;
            const emailMessage = `Hello, ${profileName.textContent}!
You have a new call booking request from ${visitorName} via your portfolio.

Visitor Details:
Name: ${visitorName}
Email: ${visitorEmail}
Phone: ${visitorPhone || 'Not provided'}

Selected Availability:
${selectedAvailability.value}

You can contact them directly to confirm the booking.`;

            try {
                // 1. Save booking to Realtime Database in a user-specific collection
                const bookingsRef = ref(rtdb, `users/${profileOwnerUserId}/bookedCalls`);
                await push(bookingsRef, bookingData);

                // 2. Send email using EmailJS
                await emailjs.send(
                    EMAILJS_SERVICE_ID,
                    EMAILJS_TEMPLATE_ID,
                    {
                        name: name,
                        to_email: profileOwnerEmail,
                        subject: emailSubject,
                        message: emailMessage,
                    },
                    {
                        publicKey: EMAILJS_PUBLIC_KEY
                    }
                );

                showNotification("Booking successful! The profile owner has been notified.");
                // Reset form inputs after successful submission
                visitorNameInput.value = '';
                visitorEmailInput.value = '';
                visitorPhoneInput.value = '';
                if (selectedAvailability) {
                    selectedAvailability.checked = false;
                }
            } catch (error) {
                console.error("Error during call booking:", error);
                // Display the error to the user for explicit feedback
                showNotification(`Failed to book a call: ${error.message}. Please try again.`, true);
            } finally {
                bookCallSubmitBtn.disabled = false;
                bookCallSubmitBtn.classList.remove('loading');
            }
        };

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Firebase App
            app = initializeApp(firebaseConfig);
            rtdb = getDatabase(app);
            
            // Directly load user profile without authentication checks
            const username = getUsernameFromUrl();
            loadUserProfile(username);
        });
  </script>
 </body>
</html>